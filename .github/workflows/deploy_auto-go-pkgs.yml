name: Deploy Go Modules

on:
  push:
    branches:
      - test
    paths:
      - 'common/protos-go/VERSION'

jobs:
  protos-go:
    runs-on: ubuntu-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
          
      - name: Set current date as env
        run: echo "RELEASE_DATE=$(date +%b\ %d,\ %Y)" >> $GITHUB_ENV
                
      - name: Set module tag and description
        run: |
          echo "MODULE_TAG=common/protos-go" >> $GITHUB_ENV
          echo "MODULE_DESC=GO Weaver Protos" >> $GITHUB_ENV
        working-directory: common/protos-go
        
      - name: Set module version
        run: echo "VERSION=$(cat VERSION)" >> $GITHUB_ENV
        working-directory: common/protos-go
            
      - name: Create protos-go Release
        id: protos-go-release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # This token is provided by Actions, you do not need to create your own token
        with:
          tag_name: ${{ env.MODULE_TAG }}/${{ env.VERSION }}
          release_name: ${{ env.VERSION }} - ${{ env.MODULE_DESC }} - ${{ env.RELEASE_DATE }}
          body: |
            - Go Module: `github.com/${{ github.repository_owner }}/weaver-dlt-interoperability/${{ env.MODULE_TAG }}`
            - Release: ${{ env.VERSION }}
            - Readme: [Here](https://github.com/${{ github.repository_owner }}/weaver-dlt-interoperability/blob/${{ env.MODULE_TAG }}/${{ env.VERSION }}/${{ env.MODULE_TAG }}/README.md).
            - Source: [Here](https://github.com/${{ github.repository_owner }}/weaver-dlt-interoperability/blob/${{ env.MODULE_TAG }}/${{ env.VERSION }}/${{ env.MODULE_TAG }})
          draft: false
          prerelease: false