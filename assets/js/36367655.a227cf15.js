"use strict";(self.webpackChunkweaver_dlt_interoperability=self.webpackChunkweaver_dlt_interoperability||[]).push([[3966],{5680:(e,a,n)=>{n.d(a,{xA:()=>g,yg:()=>u});var t=n(6540);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function i(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?i(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function o(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=t.createContext({}),p=function(e){var a=t.useContext(s),n=a;return e&&(n="function"==typeof e?e(a):l(l({},a),e)),n},g=function(e){var a=p(e.components);return t.createElement(s.Provider,{value:a},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},y=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,g=o(e,["components","mdxType","originalType","parentName"]),d=p(n),y=r,u=d["".concat(s,".").concat(y)]||d[y]||c[y]||i;return n?t.createElement(u,l(l({ref:a},g),{},{components:n})):t.createElement(u,l({ref:a},g))}));function u(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=y;var o={};for(var s in a)hasOwnProperty.call(a,s)&&(o[s]=a[s]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}y.displayName="MDXCreateElement"},3196:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var t=n(8168),r=(n(6540),n(5680));const i={id:"setup-local",title:"Setup with Locally Built Weaver Components",pagination_prev:"external/getting-started/test-network/overview",pagination_next:"external/getting-started/test-network/ledger-initialization"},l=void 0,o={unversionedId:"external/getting-started/test-network/setup-local",id:"external/getting-started/test-network/setup-local",title:"Setup with Locally Built Weaver Components",description:"\x3c!--",source:"@site/docs/external/getting-started/test-network/setup-local.md",sourceDirName:"external/getting-started/test-network",slug:"/external/getting-started/test-network/setup-local",permalink:"/weaver-dlt-interoperability/docs/external/getting-started/test-network/setup-local",draft:!1,editUrl:"https://github.com/hyperledger-labs/weaver-dlt-interoperability/edit/main/docs/external/getting-started/test-network/setup-local.md",tags:[],version:"current",frontMatter:{id:"setup-local",title:"Setup with Locally Built Weaver Components",pagination_prev:"external/getting-started/test-network/overview",pagination_next:"external/getting-started/test-network/ledger-initialization"},sidebar:"Documentation",previous:{title:"Component Overview",permalink:"/weaver-dlt-interoperability/docs/external/getting-started/test-network/overview"},next:{title:"Ledger Initialization",permalink:"/weaver-dlt-interoperability/docs/external/getting-started/test-network/ledger-initialization"}},s={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Software",id:"software",level:3},{value:"Credentials",id:"credentials",level:3},{value:"Getting the Code and Documentation",id:"getting-the-code-and-documentation",level:2},{value:"Common Structures",id:"common-structures",level:2},{value:"Securing Components",id:"securing-components",level:2},{value:"Hyperledger Fabric Components",id:"hyperledger-fabric-components",level:2},{value:"Fabric Interoperation Node SDK",id:"fabric-interoperation-node-sdk",level:3},{value:"Fabric Network",id:"fabric-network",level:3},{value:"Fabric Client (fabric-cli)",id:"fabric-client-fabric-cli",level:3},{value:"Prerequisites",id:"prerequisites-1",level:4},{value:"Installation",id:"installation",level:4},{value:"Fabric Relay",id:"fabric-relay",level:3},{value:"Building",id:"building",level:4},{value:"Deployment",id:"deployment",level:4},{value:"Fabric Driver",id:"fabric-driver",level:3},{value:"Configuring",id:"configuring",level:4},{value:"Building",id:"building-1",level:4},{value:"Running",id:"running",level:4},{value:"Fabric IIN Agent",id:"fabric-iin-agent",level:3},{value:"Building",id:"building-2",level:4},{value:"Configuration",id:"configuration",level:4},{value:"Security Domain Configuration",id:"security-domain-configuration",level:4},{value:"DNS Configuration",id:"dns-configuration",level:4},{value:"Environment Variables",id:"environment-variables",level:4},{value:"Deployment",id:"deployment-1",level:4},{value:"Corda Components",id:"corda-components",level:2},{value:"Interoperation CorDapp",id:"interoperation-cordapp",level:3},{value:"Corda Interoperation SDK",id:"corda-interoperation-sdk",level:3},{value:"Corda Simple Application and Client (Application)",id:"corda-simple-application-and-client-application",level:3},{value:"Corda Network",id:"corda-network",level:3},{value:"Corda Relay",id:"corda-relay",level:3},{value:"Corda Driver",id:"corda-driver",level:3},{value:"Building Corda Driver",id:"building-corda-driver",level:4},{value:"Configuring",id:"configuring-1",level:4},{value:"Running",id:"running-1",level:4},{value:"Hyperledger Besu Components",id:"hyperledger-besu-components",level:2},{value:"Prerequisites",id:"prerequisites-2",level:3},{value:"Besu Interoperation Node SDK",id:"besu-interoperation-node-sdk",level:3},{value:"Besu Network",id:"besu-network",level:3},{value:"Contracts",id:"contracts",level:3},{value:"Besu Client (besu-cli)",id:"besu-client-besu-cli",level:3},{value:"Prerequisites",id:"prerequisites-3",level:4},{value:"Installation",id:"installation-1",level:4},{value:"Tear Down the Setup",id:"tear-down-the-setup",level:2}],g={toc:p},d="wrapper";function c(e){let{components:a,...n}=e;return(0,r.yg)(d,(0,t.A)({},g,n,{components:a,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"In this document, we detail the steps using which you can bring up networks using the default configuration settings and by building Weaver interoperation modules, SDK libraries, and relay drivers locally from your Weaver clone. To customize these settings (e.g., hostnames, ports), refer to the ",(0,r.yg)("a",{parentName:"p",href:"/weaver-dlt-interoperability/docs/external/getting-started/test-network/advanced-configuration"},"Advanced Configuration page"),"."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"The default configuration is for a development setup, therefore all components are run on ",(0,r.yg)("inlineCode",{parentName:"td"},"localhost"),", many within Docker containers.")))),(0,r.yg)("p",null,"Follow the instructions below to build and run components followed by interoperation flows. These instructions have been tested on Ubuntu Linux (bash shell) and Mac OS. In general, they should work on any system and shell as long as the various dependenices have been installed and configured."),(0,r.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.yg)("h3",{id:"software"},"Software"),(0,r.yg)("p",null,"Before starting, make sure you have the following software installed on your host machine:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"OpenSSL: ",(0,r.yg)("em",{parentName:"p"},"install using package manager, like ",(0,r.yg)("inlineCode",{parentName:"em"},"apt")," on Debian/Ubuntu Linux (specifically packages ",(0,r.yg)("inlineCode",{parentName:"em"},"openssl")," and ",(0,r.yg)("inlineCode",{parentName:"em"},"libssl-dev"),")"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Curl: ",(0,r.yg)("em",{parentName:"p"},"install using package manager, like ",(0,r.yg)("inlineCode",{parentName:"em"},"apt")," on Debian/Ubuntu Linux"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Git: ",(0,r.yg)("a",{parentName:"p",href:"https://git-scm.com/book/en/v2/Getting-Started-Installing-Git"},"sample instructions"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Docker: ",(0,r.yg)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/"},"sample instructions")," (Latest version)")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Docker-Compose: ",(0,r.yg)("a",{parentName:"p",href:"https://docs.docker.com/compose/install/"},"sample instructions")," (Version 2 or higher)")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Golang: ",(0,r.yg)("a",{parentName:"p",href:"https://golang.org/dl/"},"sample instructions")," (Version 1.20 or higher)")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Java (JDK and JRE): ",(0,r.yg)("a",{parentName:"p",href:"https://openjdk.java.net/install/"},"sample instructions")," (Version 8)")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Node.js and NPM: ",(0,r.yg)("a",{parentName:"p",href:"https://nodejs.org/en/download/package-manager/"},"sample instructions")," (Version 16 Supported)")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Yarn: ",(0,r.yg)("a",{parentName:"p",href:"https://classic.yarnpkg.com/en/docs/install/"},"sample instructions"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Rust: ",(0,r.yg)("a",{parentName:"p",href:"https://www.rust-lang.org/tools/install"},"sample instructions"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Protoc (Protobuf compiler): ",(0,r.yg)("em",{parentName:"p"},"Golang should already be installed and configured.")),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Default method: Run the following with ",(0,r.yg)("inlineCode",{parentName:"p"},"sudo")," if necessary. This will install both the protobuf compiler and the Go code generator plugins."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},"apt-get install protobuf-compiler\ngo install google.golang.org/protobuf/cmd/protoc-gen-go@latest\ngo install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.4.0\n"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"If the above method installs an older version of ",(0,r.yg)("inlineCode",{parentName:"p"},"protoc")," (check using ",(0,r.yg)("inlineCode",{parentName:"p"},"protoc --version"),"), say below 3.12.x, you should download pre-compiled binaries instead. (With an older version, you may see errors while attempting to launch and setup the Fabric networks)."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},'sudo apt-get remove protobuf-compiler\ncurl -LO https://github.com/protocolbuffers/protobuf/releases/download/v3.15.6/protoc-3.15.6-linux-x86_64.zip\nsudo apt-get install unzip\nunzip protoc-3.15.6-linux-x86_64.zip -d <some-folder-path>\nexport PATH="$PATH:<some-folder-path>/bin"\ngo install google.golang.org/protobuf/cmd/protoc-gen-go@latest\ngo install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.4.0\n')),(0,r.yg)("table",{parentName:"li"},(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"The last version we tested with was ",(0,r.yg)("inlineCode",{parentName:"td"},"3.15.6"),", but you should check the above link to find the most current version before running the above steps.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"The latest version of ",(0,r.yg)("inlineCode",{parentName:"td"},"protoc-gen-go-grpc")," that works with the Fabric test networks we will run below is ",(0,r.yg)("inlineCode",{parentName:"td"},"v1.4.0"),", which is why that version is hardcoded here.")))))))),(0,r.yg)("h3",{id:"credentials"},"Credentials"),(0,r.yg)("p",null,"Make sure you have an SSH or GPG key registered in ",(0,r.yg)("a",{parentName:"p",href:"https://github.com"},"https://github.com")," to allow seamless cloning of repositories (at present, various setup scripts clone repositories using the ",(0,r.yg)("inlineCode",{parentName:"p"},"https://")," prefix but this may change to ",(0,r.yg)("inlineCode",{parentName:"p"},"git@")," in the future)."),(0,r.yg)("h2",{id:"getting-the-code-and-documentation"},"Getting the Code and Documentation"),(0,r.yg)("p",null,"Clone the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/hyperledger-labs/weaver-dlt-interoperability"},"weaver-dlt-interoperability")," repository. The code to get a basic test network up and running and test data-sharing interoperation flows lies in the subfolder ",(0,r.yg)("inlineCode",{parentName:"p"},"tests/network-setups"),", which should be your starting point, though the setups will rely on other parts of the repository, as you will find out in the instructions given on this page."),(0,r.yg)("h2",{id:"common-structures"},"Common Structures"),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"common/protos")," folder contains structure definitions in the protobuf format that are used by all the different components. The various ",(0,r.yg)("inlineCode",{parentName:"p"},"common/protos-*")," folders are meant to contain compiled protobufs (in different languages)."),(0,r.yg)("p",null,"To compile the protobufs for JavaScript, do the following:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"common/protos-js")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following command:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build\n")))),(0,r.yg)("p",null,"To compile the protobufs for Golang, do the following:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"common/protos-go")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following command:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build\n")))),(0,r.yg)("p",null,"To compile the protobufs for Java, do the following:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"common/protos-java-kt")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following command:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build\n")))),(0,r.yg)("p",null,"To compile the protobufs for Solidity, do the following:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"common/protos-sol")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following command:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build\n")))),(0,r.yg)("p",null,"To compile the protobufs for Rust, do the following:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"common/protos-rs")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following command:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build\n")))),(0,r.yg)("h2",{id:"securing-components"},"Securing Components"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"The relays and drivers corresponding to the different test networks you will encounter below can be run with or without TLS enabled. But the default files used in the demonstrations assume that either all relays and drivers are TLS-enabled or none are. Therefore, you should determine at the outset whether or not you wish to run the entire set of components in TLS-enabled mode, and select appropriate commands in the provided instructions.")))),(0,r.yg)("h2",{id:"hyperledger-fabric-components"},"Hyperledger Fabric Components"),(0,r.yg)("p",null,"Using the sequence of instructions below, you can start two separate Fabric networks, each with a single channel and application contract (chaincode). You can also start an interoperation contract, a relay, and a ",(0,r.yg)("em",{parentName:"p"},"driver")," acting on behalf of each network. You can build a Fabric CLI tool with which you can initialize both networks' ledgers with access control policies, foreign networks' security groups (i.e., membership providers' certificate chains), and some sample key-value pairs that can be shared during subsequent interoperation flows."),(0,r.yg)("h3",{id:"fabric-interoperation-node-sdk"},"Fabric Interoperation Node SDK"),(0,r.yg)("p",null,"A client-layer library (companion to ",(0,r.yg)("inlineCode",{parentName:"p"},"hyperledger/fabric-sdk-node"),") is defined in the ",(0,r.yg)("inlineCode",{parentName:"p"},"sdks/fabric/interoperation-node-sdk")," folder. This contains functions for Fabric Gateway-based applications to exercise interoperation capabilities via relays and also several utility/helper functions. The Fabric-CLI tool, which we will use later, depends on this library."),(0,r.yg)("p",null,"To build the library, do the following:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"sdks/fabric/interoperation-node-sdk")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following command:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build-local\n")))),(0,r.yg)("h3",{id:"fabric-network"},"Fabric Network"),(0,r.yg)("p",null,"The code for this lies in the ",(0,r.yg)("inlineCode",{parentName:"p"},"tests/network-setups")," folder."),(0,r.yg)("p",null,"This folder contains code to create and launch networks ",(0,r.yg)("inlineCode",{parentName:"p"},"network1")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"network2")," of identical specifications:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Network: 1 peer, 1 peer CA, 1 ordering service node, 1 ordering service CA"),(0,r.yg)("li",{parentName:"ul"},"Single channel named ",(0,r.yg)("inlineCode",{parentName:"li"},"mychannel")),(0,r.yg)("li",{parentName:"ul"},"One of the following contracts deployed on ",(0,r.yg)("inlineCode",{parentName:"li"},"mychannel"),", the choice depending on the ",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/interoperability-modes"},"interoperability mode")," you wish to test:",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"simplestate")," (",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/getting-started/interop/data-sharing"},"Data Sharing"),"): supports simple transactions (",(0,r.yg)("inlineCode",{parentName:"li"},"Create"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"Read"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"Update"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"Delete"),") involving storage and lookup of <key, value> pairs."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"simplestatewithacl")," (",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/getting-started/interop/data-sharing"},"Data Sharing"),"): identical to ",(0,r.yg)("inlineCode",{parentName:"li"},"simplestate")," but with extra security features to ensure that the Weaver infrastructure cannot be bypassed by a malicious client of the network."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"simpleasset")," (",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/getting-started/interop/asset-exchange/overview"},"Asset Exchange"),"): supports creation, modification, transfer, and deletion, as well as locking, unlocking, and claiming, of simple bonds and tokens (examples of non-fungible and fungible assets respectively)."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"simpleassetandinterop")," (",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/getting-started/interop/asset-exchange/overview"},"Asset Exchange"),"): identical to ",(0,r.yg)("inlineCode",{parentName:"li"},"simpleasset")," but where the locking, unlocking, and claiming logic is imported as a library in the chaincode rather than available in the common Fabric Interoperation Chaincode (a Weaver component)."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"simpleassettransfer")," (",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/getting-started/interop/asset-exchange/overview"},"Asset Exchange")," or ",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/getting-started/interop/asset-transfer"},"Asset Transfer"),"): augmentation of ",(0,r.yg)("inlineCode",{parentName:"li"},"simpleasset")," with asset pledging, claiming, and reclaiming features for cross-network transfers.")))),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"For new users, we recommend testing the Data Sharing feature first with the ",(0,r.yg)("inlineCode",{parentName:"td"},"simplestate")," contract. To test the other modes, you can simply ",(0,r.yg)("a",{parentName:"td",href:"#tear-down-the-setup"},"tear down")," the Fabric networks and restart them with the appropriate chaincodes installed.")))),(0,r.yg)("p",null,"Follow the instructions below to build and launch the networks:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"tests/network-setups/fabric/dev")," folder."),(0,r.yg)("li",{parentName:"ul"},"To spin up both network1 and network2 with the interoperation chaincode and the default ",(0,r.yg)("inlineCode",{parentName:"li"},"simplestate")," chaincode installed, run:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make start-interop-local\n"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("em",{parentName:"li"},"To launch the networks with a different application chaincode from the above list, run"),":",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make start-interop-local CHAINCODE_NAME=<chaincode-name>\n"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("em",{parentName:"li"},"To launch the networks with 2 organizations, each with a peer (this will enable more variation and experimentation, which you can attempt after testing interoperation protocols across basic network configurations), run"),":",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'make start-interop-local PROFILE="2-nodes"\n')))),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"If you do not wish to test Fabric-Fabric interoperation, you can choose to launch only one of the two networks along with its interoperation chaincode. For ",(0,r.yg)("inlineCode",{parentName:"td"},"network1"),", run ",(0,r.yg)("inlineCode",{parentName:"td"},"make start-interop-network1-local"),", and for ",(0,r.yg)("inlineCode",{parentName:"td"},"network2"),", run ",(0,r.yg)("inlineCode",{parentName:"td"},"make start-interop-network2-local"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"If you wish to enable end-to-end confidentiality by default in the interoperation modules that are deployed during network launch, set the environment variable ",(0,r.yg)("inlineCode",{parentName:"td"},"E2E_CONFIDENTIALITY")," to ",(0,r.yg)("inlineCode",{parentName:"td"},"true")," in the command line as follows: ",(0,r.yg)("inlineCode",{parentName:"td"},"E2E_CONFIDENTIALITY=true make start-interop-local"))))),(0,r.yg)("p",null,"For more information, refer to the associated ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/hyperledger-labs/weaver-dlt-interoperability/tree/main/tests/network-setups/fabric/dev"},"README"),"."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Troubleshooting Tips"),":"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"If you see any errors during the launches, re-check the prerequisites (software installations and credentials). Ensure your network connection is working. As a safe bet, you can retry after cleanup: kill and remove all Docker containers and associated volumes."),(0,r.yg)("li",{parentName:"ul"},"If ",(0,r.yg)("inlineCode",{parentName:"li"},"protoc")," or ",(0,r.yg)("inlineCode",{parentName:"li"},"protoc-gen-go")," throws an error, reinstall ",(0,r.yg)("inlineCode",{parentName:"li"},"protoc"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"protoc-gen-go"),", and ",(0,r.yg)("inlineCode",{parentName:"li"},"protoc-gen-go-grpc")," using suggestions made in the Prerequisites section above.")),(0,r.yg)("h3",{id:"fabric-client-fabric-cli"},"Fabric Client (fabric-cli)"),(0,r.yg)("p",null,"The CLI is used to interact with a Fabric network, configure it and run chaincode transactions to record data on the channel ledger or query data. It is also used to interact with remote networks through the relay to trigger an interoperation flow for data request and acceptance."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"fabric-cli")," Node.js source code is located in the ",(0,r.yg)("inlineCode",{parentName:"p"},"samples/fabric/fabric-cli")," folder and the Golang source code in the ",(0,r.yg)("inlineCode",{parentName:"p"},"samples/fabric/go-cli")," folder."),(0,r.yg)("h4",{id:"prerequisites-1"},"Prerequisites"),(0,r.yg)("p",null,"If you are using a Linux system, make sure that lib64 is installed."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"For the Node.js version of the ",(0,r.yg)("inlineCode",{parentName:"td"},"fabric-cli"),", the setup and running instructions below were tested with all Node.js versions from v11.14.0 to v14.17.3.")))),(0,r.yg)("h4",{id:"installation"},"Installation"),(0,r.yg)("p",null,"You can install ",(0,r.yg)("inlineCode",{parentName:"p"},"fabric-cli")," as follows (for both the Node.js and Golang versions):"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"samples/fabric/fabric-cli")," folder (for the Node.js version) or the ",(0,r.yg)("inlineCode",{parentName:"li"},"samples/fabric/go-cli")," folder (for the Golang version)."),(0,r.yg)("li",{parentName:"ul"},"Run the following to install dependencies (for the Node.js version) or the executable (for the Golang version):",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build-local\n"))),(0,r.yg)("li",{parentName:"ul"},"Use the ",(0,r.yg)("inlineCode",{parentName:"li"},"fabric-cli")," executable in the ",(0,r.yg)("inlineCode",{parentName:"li"},"bin")," folder for ",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/getting-started/test-network/ledger-initialization"},"subsequent actions"),".")),(0,r.yg)("h3",{id:"fabric-relay"},"Fabric Relay"),(0,r.yg)("p",null,"The relay is a module acting on behalf of a network, enabling interoperation flows with other networks by communicating with their relays.\nThe code for this lies in the ",(0,r.yg)("inlineCode",{parentName:"p"},"core/relay")," folder."),(0,r.yg)("h4",{id:"building"},"Building"),(0,r.yg)("p",null,(0,r.yg)("em",{parentName:"p"},"Prerequisite"),": make sure Rust is already installed and that the ",(0,r.yg)("inlineCode",{parentName:"p"},"cargo")," executable is in your system path (after installation of Rust, this should be available in ",(0,r.yg)("inlineCode",{parentName:"p"},"$HOME/.cargo/bin"),"); you can also ensure this by running ",(0,r.yg)("inlineCode",{parentName:"p"},'source "$HOME/.cargo/env"'),"."),(0,r.yg)("p",null,"Build the generic (i.e., common to all DLTs) relay module as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/relay")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make\n"))),(0,r.yg)("li",{parentName:"ul"},"If you observe errors during the above compilation, update certain packages (on which the Weaver Relay is dependent) to their latest versions and recompile as follows:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make update-pkgs\nmake\n")))),(0,r.yg)("h4",{id:"deployment"},"Deployment"),(0,r.yg)("p",null,"An instance or a relay can be run using a suitable configuration file. Samples are available in the ",(0,r.yg)("inlineCode",{parentName:"p"},"core/relay/config")," folder."),(0,r.yg)("p",null,"Run a relay for ",(0,r.yg)("inlineCode",{parentName:"p"},"network1")," as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/relay")," folder."),(0,r.yg)("li",{parentName:"ul"},"To launch the server without TLS, leave the configuration file ",(0,r.yg)("inlineCode",{parentName:"li"},"config/Fabric_Relay.toml")," in its default state. Otherwise, edit it to set TLS flags for this relay and the other relays and drivers it will connect to in this demonstration as follows:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-toml"},'.\n.\ncert_path="credentials/fabric_cert.pem"\nkey_path="credentials/fabric_key"\ntls=true\n.\n.\n[relays]\n[relays.Corda_Relay]\nhostname="localhost"\nport="9081"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n[relays.Corda_Relay2]\nhostname="localhost"\nport="9082"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n[relays.Fabric_Relay2]\nhostname="localhost"\nport="9083"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n.\n.\n[drivers]\n[drivers.Fabric]\nhostname="localhost"\nport="9090"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n.\n.\n'))),(0,r.yg)("li",{parentName:"ul"},"To launch the server, simply run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"RELAY_CONFIG=config/Fabric_Relay.toml cargo run --bin server\n")))),(0,r.yg)("p",null,"Run a relay for ",(0,r.yg)("inlineCode",{parentName:"p"},"network2")," as follows (",(0,r.yg)("em",{parentName:"p"},"do this only if you have launched both Fabric networks ",(0,r.yg)("inlineCode",{parentName:"em"},"network1")," and ",(0,r.yg)("inlineCode",{parentName:"em"},"network2")," and wish to test interoperation between them"),")"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/relay")," folder."),(0,r.yg)("li",{parentName:"ul"},"To launch the server without TLS, leave the configuration file ",(0,r.yg)("inlineCode",{parentName:"li"},"config/Fabric_Relay2.toml")," in its default state. Otherwise, edit it to set TLS flags for this relay and the other relays and drivers it will connect to in this demonstration as follows:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-toml"},'.\n.\ncert_path="credentials/fabric_cert.pem"\nkey_path="credentials/fabric_key"\ntls=true\n.\n.\n[relays]\n[relays.Corda_Relay]\nhostname="localhost"\nport="9081"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n[relays.Corda_Relay2]\nhostname="localhost"\nport="9082"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n[relays.Fabric_Relay]\nhostname="localhost"\nport="9080"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n.\n.\n[drivers]\n[drivers.Fabric]\nhostname="localhost"\nport="9095"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n.\n.\n'))),(0,r.yg)("li",{parentName:"ul"},"To launch the server, simply run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"RELAY_CONFIG=config/Fabric_Relay2.toml cargo run --bin server\n")))),(0,r.yg)("p",null,"For more information, see the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/hyperledger-labs/weaver-dlt-interoperability/tree/main/core/relay"},"relay README"),"."),(0,r.yg)("h3",{id:"fabric-driver"},"Fabric Driver"),(0,r.yg)("p",null,"A driver is a DLT-specific plugin invoked by the relay while conveying external data queries to the local peer network and collecting a response with proofs. The Fabric driver is built as a Fabric client application on the ",(0,r.yg)("inlineCode",{parentName:"p"},"fabric-network")," NPM package.\nThe code for this lies in the ",(0,r.yg)("inlineCode",{parentName:"p"},"core/drivers/fabric-driver")," folder."),(0,r.yg)("h4",{id:"configuring"},"Configuring"),(0,r.yg)("p",null,"In the ",(0,r.yg)("inlineCode",{parentName:"p"},"core/drivers/fabric-driver")," folder, copy ",(0,r.yg)("inlineCode",{parentName:"p"},".env.template")," to ",(0,r.yg)("inlineCode",{parentName:"p"},".env")," and update ",(0,r.yg)("inlineCode",{parentName:"p"},"CONNECTION_PROFILE")," to point to the connection profile of the Fabric network (e.g. ",(0,r.yg)("inlineCode",{parentName:"p"},"<PATH-TO-WEAVER>/tests/network-setups/fabric/shared/network1/peerOrganizations/org1.network1.com/connection-org1.json"),")"),(0,r.yg)("p",null,"Configure ",(0,r.yg)("inlineCode",{parentName:"p"},"fabric-driver")," for ",(0,r.yg)("inlineCode",{parentName:"p"},"network1")," as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/drivers/fabric-driver")," folder."),(0,r.yg)("li",{parentName:"ul"},"Create a ",(0,r.yg)("inlineCode",{parentName:"li"},".env")," file by copying ",(0,r.yg)("inlineCode",{parentName:"li"},".env.template")," and setting suitable parameter values:",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"The ",(0,r.yg)("inlineCode",{parentName:"li"},"CONNECTION_PROFILE")," should point to the absolute path of the connection profile for ",(0,r.yg)("inlineCode",{parentName:"li"},"network1"),".",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"For this exercise, specify the path ",(0,r.yg)("inlineCode",{parentName:"li"},"<PATH-TO-WEAVER>/tests/network-setups/fabric/shared/network1/peerOrganizations/org1.network1.com/connection-org1.json")," (",(0,r.yg)("em",{parentName:"li"},"you must specify the full absolute path here"),")."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"<PATH-TO-WEAVER>")," here is the absolute path of the ",(0,r.yg)("inlineCode",{parentName:"li"},"weaver-dlt-interoperability")," clone folder."))),(0,r.yg)("li",{parentName:"ul"},"If you wish to start the driver without TLS, set the following parameter values:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},"RELAY_TLS=false\nRELAY_TLSCA_CERT_PATH=\nDRIVER_TLS=false\nDRIVER_TLS_CERT_PATH=\nDRIVER_TLS_KEY_PATH=\n")),"Otherwise, if you wish to start the driver with TLS enabled, set the following parameter values (replace ",(0,r.yg)("inlineCode",{parentName:"li"},"<PATH-TO-WEAVER>")," with the absolute path of the ",(0,r.yg)("inlineCode",{parentName:"li"},"weaver-dlt-interoperability")," clone folder):",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},"RELAY_TLS=true\nRELAY_TLSCA_CERT_PATH=<PATH-TO-WEAVER>/core/relay/credentials/fabric_ca_cert.pem\nDRIVER_TLS=true\nDRIVER_TLS_CERT_PATH=<PATH-TO-WEAVER>/core/relay/credentials/fabric_cert.pem\nDRIVER_TLS_KEY_PATH=<PATH-TO-WEAVER>/core/relay/credentials/fabric_key\n"))),(0,r.yg)("li",{parentName:"ul"},"Leave the default values unchanged for the other parameters. The relay and driver endpoints as well as the network name are already specified in the template.")))),(0,r.yg)("h4",{id:"building-1"},"Building"),(0,r.yg)("p",null,"Build the Fabric driver module as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/drivers/fabric-driver")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build-local\n")))),(0,r.yg)("h4",{id:"running"},"Running"),(0,r.yg)("p",null,"Run a Fabric driver for ",(0,r.yg)("inlineCode",{parentName:"p"},"network1")," as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/drivers/fabric-driver")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"npm run dev\n")))),(0,r.yg)("p",null,"Run a Fabric driver for ",(0,r.yg)("inlineCode",{parentName:"p"},"network2")," as follows (",(0,r.yg)("em",{parentName:"p"},"do this only if you wish to test interoperation between the two Fabric networks ",(0,r.yg)("inlineCode",{parentName:"em"},"network1")," and ",(0,r.yg)("inlineCode",{parentName:"em"},"network2")),")"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/drivers/fabric-driver")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following (replace ",(0,r.yg)("inlineCode",{parentName:"li"},"<PATH-TO-WEAVER>")," with the absolute path of the ",(0,r.yg)("inlineCode",{parentName:"li"},"weaver-dlt-interoperability")," clone folder):",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"CONNECTION_PROFILE=<PATH-TO-WEAVER>/tests/network-setups/fabric/shared/network2/peerOrganizations/org1.network2.com/connection-org1.json NETWORK_NAME=network2 RELAY_ENDPOINT=localhost:9083 DRIVER_ENDPOINT=localhost:9095 npm run dev\n")))),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"The variables we specified earlier in the ",(0,r.yg)("inlineCode",{parentName:"td"},".env")," for ",(0,r.yg)("inlineCode",{parentName:"td"},"network1")," are now passed in the command line. Alternatively, you can make a copy of the ",(0,r.yg)("inlineCode",{parentName:"td"},"fabric-driver")," folder with a different  name and create a separate ",(0,r.yg)("inlineCode",{parentName:"td"},".env")," file within it that contains links to the connection profile, relay, and driver for ",(0,r.yg)("inlineCode",{parentName:"td"},"network2"),".")))),(0,r.yg)("h3",{id:"fabric-iin-agent"},"Fabric IIN Agent"),(0,r.yg)("p",null,"IIN Agent is a client of a member of a DLT network or security domain with special permissions to update security domain identities and configurations on the ledger via the network's interoperation module. The code for this lies in the ",(0,r.yg)("inlineCode",{parentName:"p"},"core/identity-management/iin-agent")," folder. Navigate to the ",(0,r.yg)("inlineCode",{parentName:"p"},"core/identity-management/iin-agent")," folder."),(0,r.yg)("h4",{id:"building-2"},"Building"),(0,r.yg)("p",null,"To build the IIN Agent, run:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build-local\n")),(0,r.yg)("h4",{id:"configuration"},"Configuration"),(0,r.yg)("p",null,"Ledger config file specifies ledger specific IIN Agent details such as identity and which network and organization to connect to."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"To create config file for ",(0,r.yg)("inlineCode",{parentName:"p"},"Org1MSP"),"'s Fabric IIN Agent of ",(0,r.yg)("inlineCode",{parentName:"p"},"network1"),", follow the steps:"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Create copy of template config file for Fabric IIN Agent: ",(0,r.yg)("inlineCode",{parentName:"li"},"src/fabric-ledger/config.json.template"),", say to location ",(0,r.yg)("inlineCode",{parentName:"li"},"src/fabric-ledger/config-n1-org1.json"),"."),(0,r.yg)("li",{parentName:"ul"},"Replace ",(0,r.yg)("inlineCode",{parentName:"li"},"<path-to-connection-profile>")," with ",(0,r.yg)("inlineCode",{parentName:"li"},"<PATH-TO-WEAVER>/tests/network-setups/fabric/shared/network1/peerOrganizations/org1.network1.com/connection-org1.json"),", where ",(0,r.yg)("inlineCode",{parentName:"li"},"<PATH-TO-WEAVER>")," should be substituted with the absolute path location of your clone of Weaver."),(0,r.yg)("li",{parentName:"ul"},"Set ",(0,r.yg)("inlineCode",{parentName:"li"},"mspId")," as ",(0,r.yg)("inlineCode",{parentName:"li"},"Org1MSP"),"."),(0,r.yg)("li",{parentName:"ul"},"Set ",(0,r.yg)("inlineCode",{parentName:"li"},"agent.affiliation")," as ",(0,r.yg)("inlineCode",{parentName:"li"},"org1.department1"),"."))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"To create config file for ",(0,r.yg)("inlineCode",{parentName:"p"},"Org2MSP"),"'s Fabric IIN Agent of ",(0,r.yg)("inlineCode",{parentName:"p"},"network1"),", repeat ",(0,r.yg)("inlineCode",{parentName:"p"},"Step 1")," with different name for config file, say ",(0,r.yg)("inlineCode",{parentName:"p"},"src/fabric-ledger/config-n1-org2.json"),", and replace ",(0,r.yg)("inlineCode",{parentName:"p"},"org1")," with ",(0,r.yg)("inlineCode",{parentName:"p"},"org2")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"Org1MSP")," with ",(0,r.yg)("inlineCode",{parentName:"p"},"Org2MSP"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"To create config file for ",(0,r.yg)("inlineCode",{parentName:"p"},"Org1MSP"),"'s Fabric IIN Agent of ",(0,r.yg)("inlineCode",{parentName:"p"},"network2"),", repeat ",(0,r.yg)("inlineCode",{parentName:"p"},"Step 1")," with different name for config file, say ",(0,r.yg)("inlineCode",{parentName:"p"},"src/fabric-ledger/config-n2-org1.json"),", and replace ",(0,r.yg)("inlineCode",{parentName:"p"},"network1")," with ",(0,r.yg)("inlineCode",{parentName:"p"},"network2"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"To create config file for ",(0,r.yg)("inlineCode",{parentName:"p"},"Org2MSP"),"'s Fabric IIN Agent of ",(0,r.yg)("inlineCode",{parentName:"p"},"network2"),", repeat ",(0,r.yg)("inlineCode",{parentName:"p"},"Step 1")," with different name for config file, say ",(0,r.yg)("inlineCode",{parentName:"p"},"src/fabric-ledger/config-n2-org2.json"),", and replace ",(0,r.yg)("inlineCode",{parentName:"p"},"network1")," with ",(0,r.yg)("inlineCode",{parentName:"p"},"network2"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"org1")," with ",(0,r.yg)("inlineCode",{parentName:"p"},"org2")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"Org1MSP")," with ",(0,r.yg)("inlineCode",{parentName:"p"},"Org2MSP"),"."))),(0,r.yg)("h4",{id:"security-domain-configuration"},"Security Domain Configuration"),(0,r.yg)("p",null,"Security Domain config file specifies the scope of security domain, which can be a channel in Fabric networks or list of nodes. File ",(0,r.yg)("inlineCode",{parentName:"p"},"docker-testnet/configs/security-domain-config.json")," can be used for Weaver testnets."),(0,r.yg)("h4",{id:"dns-configuration"},"DNS Configuration"),(0,r.yg)("p",null,"To allow an IIN Agent's to be able to discover other IIN Agents, a config file for DNS is required. Create one ",(0,r.yg)("inlineCode",{parentName:"p"},"dnsconfig.json")," by creating a copy of template ",(0,r.yg)("inlineCode",{parentName:"p"},"dnsconfig.json.template"),", and replace the values with:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"If Fabric networks are started with 1 org, and IIN Agent are to be started without TLS, use following values:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "network1": {\n        "Org1MSP": {\n            "endpoint": "localhost:9500",\n            "tls": false,\n            "tlsCACertPath": ""\n        }\n    },\n    "network2": {\n        "Org1MSP": {\n            "endpoint": "localhost:9501",\n            "tls": false,\n            "tlsCACertPath": ""\n        }\n    }\n}\n')),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"If Fabric networks are started with 1 org, and IIN Agent are to be started with TLS, use following values:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "network1": {\n        "Org1MSP": {\n            "endpoint": "localhost:9500",\n            "tls": true,\n            "tlsCACertPath": "../../relay/credentials/fabric_ca_cert.pem"\n        }\n    },\n    "network2": {\n        "Org1MSP": {\n            "endpoint": "localhost:9501",\n            "tls": true,\n            "tlsCACertPath": "../../relay/credentials/fabric_ca_cert.pem"\n        }\n    }\n}\n')),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"If Fabric networks are started with 2 orgs, and IIN Agent are to be started without TLS, use following values:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "network1": {\n        "Org1MSP": {\n            "endpoint": "localhost:9500",\n            "tls": false,\n            "tlsCACertPath": ""\n        },\n        "Org2MSP": {\n            "endpoint": "localhost:9510",\n            "tls": false,\n            "tlsCACertPath": ""\n        }\n    },\n    "network2": {\n        "Org1MSP": {\n            "endpoint": "localhost:9501",\n            "tls": false,\n            "tlsCACertPath": ""\n        },\n        "Org2MSP": {\n            "endpoint": "localhost:9511",\n            "tls": false,\n            "tlsCACertPath": ""\n        }\n    }\n}\n')),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"If Fabric networks are started with 2 orgs, and IIN Agent are to be started with TLS, use following values:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "network1": {\n        "Org1MSP": {\n            "endpoint": "localhost:9500",\n            "tls": true,\n            "tlsCACertPath": "../../relay/credentials/fabric_ca_cert.pem"\n        },\n        "Org2MSP": {\n            "endpoint": "localhost:9510",\n            "tls": true,\n            "tlsCACertPath": "../../relay/credentials/fabric_ca_cert.pem"\n        }\n    },\n    "network2": {\n        "Org1MSP": {\n            "endpoint": "localhost:9501",\n            "tls": true,\n            "tlsCACertPath": "../../relay/credentials/fabric_ca_cert.pem"\n        },\n        "Org2MSP": {\n            "endpoint": "localhost:9511",\n            "tls": true,\n            "tlsCACertPath": "../../relay/credentials/fabric_ca_cert.pem"\n        }\n    }\n}\n')),(0,r.yg)("h4",{id:"environment-variables"},"Environment Variables"),(0,r.yg)("p",null,"To configure environment variables for ",(0,r.yg)("inlineCode",{parentName:"p"},"Org1MSP"),"'s Fabric IIN Agent of ",(0,r.yg)("inlineCode",{parentName:"p"},"network1"),", follow the steps:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Create a copy of ",(0,r.yg)("inlineCode",{parentName:"li"},".env.template")," as ",(0,r.yg)("inlineCode",{parentName:"li"},".env"),", and update following values based on previous configuration file paths:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"IIN_AGENT_ENDPOINT=localhost:9500\nMEMBER_ID=Org1MSP\nSECURITY_DOMAIN=network1\nDLT_TYPE=fabric\nCONFIG_PATH=./src/fabric-ledger/config-n1-org1.json\nDNS_CONFIG_PATH=./dnsconfig.json\nSECURITY_DOMAIN_CONFIG_PATH=./docker-testnet/configs/security-domain-config.json\nWEAVER_CONTRACT_ID=interop\nAUTO_SYNC=true\n")),(0,r.yg)("ol",{start:2},(0,r.yg)("li",{parentName:"ol"},"If IIN Agent has to be started with TLS enabled, also update following values:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"IIN_AGENT_TLS=true\nIIN_AGENT_TLS_CERT_PATH=../../relay/credentials/fabric_cert.pem\nIIN_AGENT_TLS_KEY_PATH=../../relay/credentials/fabric_key\n")),(0,r.yg)("h4",{id:"deployment-1"},"Deployment"),(0,r.yg)("p",null,"Use the following steps to run Fabric IIN Agents in host machine:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"To start IIN Agent for ",(0,r.yg)("inlineCode",{parentName:"li"},"Org1MSP")," of ",(0,r.yg)("inlineCode",{parentName:"li"},"network1"),", run:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"npm run dev\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"To start IIN Agent for ",(0,r.yg)("inlineCode",{parentName:"li"},"Org2MSP")," of ",(0,r.yg)("inlineCode",{parentName:"li"},"network1")," (",(0,r.yg)("em",{parentName:"li"},"only required if Fabric network was started with 2 orgs"),"), run:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"IIN_AGENT_ENDPOINT=localhost:9510 MEMBER_ID=Org2MSP CONFIG_PATH=./src/fabric-ledger/config-n1-org2.json npm run dev\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"To start IIN Agent for ",(0,r.yg)("inlineCode",{parentName:"li"},"Org1MSP")," of ",(0,r.yg)("inlineCode",{parentName:"li"},"network2"),", run:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"IIN_AGENT_ENDPOINT=localhost:9501 SECURITY_DOMAIN=network2 CONFIG_PATH=./src/fabric-ledger/config-n2-org1.json npm run dev\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"To start IIN Agent for ",(0,r.yg)("inlineCode",{parentName:"li"},"Org2MSP")," of ",(0,r.yg)("inlineCode",{parentName:"li"},"network2")," (",(0,r.yg)("em",{parentName:"li"},"only required if Fabric network was started with 2 orgs"),"), run:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"IIN_AGENT_ENDPOINT=localhost:9511 MEMBER_ID=Org2MSP SECURITY_DOMAIN=network2 CONFIG_PATH=./src/fabric-ledger/config-n2-org2.json npm run dev\n")),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"The variables we specified earlier in the ",(0,r.yg)("inlineCode",{parentName:"td"},".env")," for ",(0,r.yg)("inlineCode",{parentName:"td"},"network1")," are now passed in the command line. Alternatively, you can make a copy of the ",(0,r.yg)("inlineCode",{parentName:"td"},"fabric-driver")," folder with a different  name and create a separate ",(0,r.yg)("inlineCode",{parentName:"td"},".env")," file within it that contains links to the connection profile, relay, and driver for ",(0,r.yg)("inlineCode",{parentName:"td"},"network2"),".")))),(0,r.yg)("h2",{id:"corda-components"},"Corda Components"),(0,r.yg)("p",null,"Using the sequence of instructions below, you can start a Corda network and run an application CorDapp on it. You can also run an interoperation CorDapp, a relay and a ",(0,r.yg)("em",{parentName:"p"},"driver")," acting on behalf of the network. You can initialize the network's vault with access control policies, foreign networks' security groups (i.e., membership providers' certificate chains), and some sample state values that can be shared during subsequent interoperation flows."),(0,r.yg)("h3",{id:"interoperation-cordapp"},"Interoperation CorDapp"),(0,r.yg)("p",null,"The interoperation CorDapp is deployed to run as part of any Corda application flow that involves cross-network interoperation."),(0,r.yg)("p",null,"Build the interoperation CorDapp as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/network/corda-interop-app")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following to create the JAR files on which other Corda network components will depend on:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build-local\n")))),(0,r.yg)("h3",{id:"corda-interoperation-sdk"},"Corda Interoperation SDK"),(0,r.yg)("p",null,"A client-layer library is defined in the ",(0,r.yg)("inlineCode",{parentName:"p"},"sdks/corda")," folder. This contains functions for Corda based client applications to exercise interoperation capabilities via relays and also several utility/helper functions. The Corda Client tool, which we will use later, depends on this library."),(0,r.yg)("p",null,"To build the library, do the following:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"sdks/corda")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following command (",(0,r.yg)("em",{parentName:"li"},"make sure there is no github.properties file present in the directory"),"):",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build\n")))),(0,r.yg)("h3",{id:"corda-simple-application-and-client-application"},"Corda Simple Application and Client (Application)"),(0,r.yg)("p",null,"This is a simple CorDapp that maintains a state of type ",(0,r.yg)("inlineCode",{parentName:"p"},"SimpleState"),", which is a set of key-value pairs (of strings).\nThe code for this lies in the ",(0,r.yg)("inlineCode",{parentName:"p"},"samples/corda/corda-simple-application")," folder."),(0,r.yg)("p",null,"Build the ",(0,r.yg)("inlineCode",{parentName:"p"},"corda-simple-application")," CorDapp as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"samples/corda/corda-simple-application")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build-local\n")))),(0,r.yg)("h3",{id:"corda-network"},"Corda Network"),(0,r.yg)("p",null,"The Corda networks' code lies in the ",(0,r.yg)("inlineCode",{parentName:"p"},"tests/network-setups/corda")," folder. You can launch two separate Corda networks, namely ",(0,r.yg)("inlineCode",{parentName:"p"},"Corda_Network")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"Corda_Network2"),". Each network runs the ",(0,r.yg)("inlineCode",{parentName:"p"},"samples/corda/corda-simple-application")," CorDapp by default, which maintains a state named ",(0,r.yg)("inlineCode",{parentName:"p"},"SimpleState")," containing a set of key-value pairs (of strings)."),(0,r.yg)("p",null,"Follow the instructions below to build and launch both networks:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"tests/network-setups/corda")," folder."),(0,r.yg)("li",{parentName:"ul"},"To spin up the Corda networks with the Interoperation CorDapps:",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Each consisting of 1 node and a notary (for data-transfer), run:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make start-local\n"))),(0,r.yg)("li",{parentName:"ul"},"Each consisting of 2 nodes and a notary (for asset-exchange/transfer), run:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'make start-local PROFILE="2-nodes"\n'))),(0,r.yg)("li",{parentName:"ul"},"Each consisting of 3 nodes and a notary (for asset-exchange/transfer), run:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'make start-local PROFILE="3-nodes"\n')))))),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"If you do not wish to test Corda-Corda interoperation, you can choose to launch only one of the two networks along with its interoperation CorDapp. For ",(0,r.yg)("inlineCode",{parentName:"td"},"Corda_Network"),", run ",(0,r.yg)("inlineCode",{parentName:"td"},"make start-network1-local"),", and for ",(0,r.yg)("inlineCode",{parentName:"td"},"Corda_Network2"),", run ",(0,r.yg)("inlineCode",{parentName:"td"},"make start-network2-local"),".")))),(0,r.yg)("p",null,"You should see the following message in the terminal:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"Waiting for network node services to start\n")),(0,r.yg)("p",null,"The Corda nodes and notary may take a while (several minutes on memory-constrained systems) to start. If they start up successfully, you should something like the following for each network, though the number of node entries will depend on the profile you used to start the network with (replace ",(0,r.yg)("inlineCode",{parentName:"p"},"<network-name>")," with ",(0,r.yg)("inlineCode",{parentName:"p"},"Corda_Network")," or ",(0,r.yg)("inlineCode",{parentName:"p"},"Corda_Network2"),"):"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"PartyA node services started for network <network-name>\nPartyB node services started for network <network-name>\nPartyC node services started for network <network-name>\nNotary node services started for network <network-name>\n")),(0,r.yg)("h3",{id:"corda-relay"},"Corda Relay"),(0,r.yg)("p",null,"The relay was built earlier, so you just need to use a different configuration file to start a relay for the Corda network."),(0,r.yg)("p",null,"Run a relay for ",(0,r.yg)("inlineCode",{parentName:"p"},"Corda_Network")," as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"p"},"core/relay")," folder.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"(Make sure you've already built the relay by running ",(0,r.yg)("inlineCode",{parentName:"p"},"make"),".)")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"To launch the server without TLS, leave the configuration file ",(0,r.yg)("inlineCode",{parentName:"p"},"config/Corda_Relay.toml")," in its default state. Otherwise, edit it to set TLS flags for this relay and the other relays and drivers it will connect to in this demonstration as follows:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-toml"},'.\n.\ncert_path="credentials/fabric_cert.pem"\nkey_path="credentials/fabric_key"\ntls=true\n.\n.\n[relays]\n[relays.Fabric_Relay]\nhostname="localhost"\nport="9080"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n[relays.Fabric_Relay2]\nhostname="localhost"\nport="9083"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n[relays.Corda_Relay2]\nhostname="localhost"\nport="9082"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n.\n.\n[drivers]\n[drivers.Corda]\nhostname="localhost"\nport="9099"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n.\n.\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"To launch the server, simply run the following:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"RELAY_CONFIG=config/Corda_Relay.toml cargo run --bin server\n")),(0,r.yg)("p",{parentName:"li"},"If the relay starts up successfully, the following will be logged on your terminal:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},'Relay Name: "Corda_Relay"\nRelayServer listening on [::1]:9081\n')))),(0,r.yg)("p",null,"Run a relay for ",(0,r.yg)("inlineCode",{parentName:"p"},"Corda_Network2")," as follows (",(0,r.yg)("em",{parentName:"p"},"do this only if you have launched both Corda networks ",(0,r.yg)("inlineCode",{parentName:"em"},"Corda_Network")," and ",(0,r.yg)("inlineCode",{parentName:"em"},"Corda_Network2")," and wish to test interoperation between them"),")"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"p"},"core/relay")," folder.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"To launch the server without TLS, leave the configuration file ",(0,r.yg)("inlineCode",{parentName:"p"},"config/Corda_Relay2.toml")," in its default state. Otherwise, edit it to set TLS flags for this relay and the other relays and drivers it will connect to in this demonstration as follows:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-toml"},'.\n.\ncert_path="credentials/fabric_cert.pem"\nkey_path="credentials/fabric_key"\ntls=true\n.\n.\n[relays]\n[relays.Fabric_Relay]\nhostname="localhost"\nport="9080"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n[relays.Fabric_Relay2]\nhostname="localhost"\nport="9083"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n[relays.Corda_Relay]\nhostname="localhost"\nport="9081"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n.\n.\n[drivers]\n[drivers.Corda]\nhostname="localhost"\nport="9098"\ntls=true\ntlsca_cert_path="credentials/fabric_ca_cert.pem"\n.\n.\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"To launch the server, simply run the following:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"RELAY_CONFIG=config/Corda_Relay2.toml cargo run --bin server\n")),(0,r.yg)("p",{parentName:"li"},"If the relay starts up successfully, the following will be logged on your terminal:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},'Relay Name: "Corda2_Relay"\nRelayServer listening on [::1]:9082\n')))),(0,r.yg)("h3",{id:"corda-driver"},"Corda Driver"),(0,r.yg)("p",null,"The code for this lies in the ",(0,r.yg)("inlineCode",{parentName:"p"},"core/drivers/corda-driver")," folder."),(0,r.yg)("h4",{id:"building-corda-driver"},"Building Corda Driver"),(0,r.yg)("p",null,"Build the Corda driver module as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/drivers/corda-driver")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build-local\n")))),(0,r.yg)("h4",{id:"configuring-1"},"Configuring"),(0,r.yg)("p",null,"Configure the drivers as follows (you can skip this if you wish to run the drivers without TLS):"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/drivers/corda-driver")," folder and create a ",(0,r.yg)("inlineCode",{parentName:"li"},".env")," file."),(0,r.yg)("li",{parentName:"ul"},"To run the drivers without TLS, set the following default values:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},"RELAY_TLS=false\nRELAY_TLSCA_TRUST_STORE=\nRELAY_TLSCA_TRUST_STORE_PASSWORD=\nRELAY_TLSCA_CERT_PATHS=\n"))),(0,r.yg)("li",{parentName:"ul"},"To run the drivers with TLS, set the following values (replace ",(0,r.yg)("inlineCode",{parentName:"li"},"<PATH-TO-WEAVER>")," with the absolute path of the ",(0,r.yg)("inlineCode",{parentName:"li"},"weaver-dlt-interoperability")," clone folder):",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},"RELAY_TLS=true\nRELAY_TLSCA_TRUST_STORE=<PATH-TO-WEAVER>/core/relay/credentials/fabric_trust_store.jks\nRELAY_TLSCA_TRUST_STORE_PASSWORD=trelay\nRELAY_TLSCA_CERT_PATHS=<PATH-TO-WEAVER>/core/relay/credentials/fabric_ca_cert.pem\n")))),(0,r.yg)("h4",{id:"running-1"},"Running"),(0,r.yg)("p",null,"Run a Corda driver as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"core/drivers/corda-driver")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following to start Corda driver for ",(0,r.yg)("inlineCode",{parentName:"li"},"Corda_Network"),":",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"./build/install/corda-driver/bin/corda-driver\n")),"If the driver starts successfully, it should log the following message on your terminal:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},"Corda driver gRPC server started. Listening on port 9099\n"))),(0,r.yg)("li",{parentName:"ul"},"Run the following to start Corda driver for ",(0,r.yg)("inlineCode",{parentName:"li"},"Corda_Network2"),":",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"DRIVER_PORT=9098 ./build/install/corda-driver/bin/corda-driver\n")),"If the driver starts successfully, it should log the following message on your terminal:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},"Corda driver gRPC server started. Listening on port 9098\n")))),(0,r.yg)("h2",{id:"hyperledger-besu-components"},"Hyperledger Besu Components"),(0,r.yg)("p",null,"Using the sequence of instructions below, you can start two separate Besu networks, each with 4 validator nodes, and EthSigner and application contract. You can also install an interoperation contract in the network. You can build a Besu CLI tool with which you can initialize both networks' ledgers."),(0,r.yg)("h3",{id:"prerequisites-2"},"Prerequisites"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Java (JDK and JRE): ",(0,r.yg)("a",{parentName:"li",href:"https://openjdk.java.net/install/"},"sample instructions")," (Version 11)\nYou need to run Besu instructions in a separate environment (separate terminal or machine) than Corda, as Corda requires Java 8. You can also use ",(0,r.yg)("inlineCode",{parentName:"li"},"update-alternatives")," to switch between java versions."),(0,r.yg)("li",{parentName:"ul"},"tmux: ",(0,r.yg)("inlineCode",{parentName:"li"},"sudo apt install tmux")),(0,r.yg)("li",{parentName:"ul"},"Besu: ",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Download and unpack the latest ",(0,r.yg)("a",{parentName:"li",href:"https://github.com/hyperledger/besu/releases/latest"},"https://github.com/hyperledger/besu/releases/latest"),". You will find it in the link of the form: ",(0,r.yg)("a",{parentName:"li",href:"https://hyperledger.jfrog.io/artifactory/besu-binaries/besu/x.y.z/besu-x.y.z.zip"},"https://hyperledger.jfrog.io/artifactory/besu-binaries/besu/x.y.z/besu-x.y.z.zip")," with x.y.z replaced with the version number. For instance, run the following command after updating version number accordingly.",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},"wget https://hyperledger.jfrog.io/artifactory/besu-binaries/besu/21.7.0/besu-21.7.0.zip\n"))),(0,r.yg)("li",{parentName:"ul"},"Add the path to ",(0,r.yg)("inlineCode",{parentName:"li"},"besu-x.y.z/bin")," to your system PATH"))),(0,r.yg)("li",{parentName:"ul"},"EthSigner: ",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Download and unpack the latest from ",(0,r.yg)("a",{parentName:"li",href:"https://cloudsmith.io/~consensys/repos/ethsigner/packages/?q=tag%3Alatest"},"https://cloudsmith.io/~consensys/repos/ethsigner/packages/?q=tag%3Alatest")," (Requires Java 11 or later)"),(0,r.yg)("li",{parentName:"ul"},"Add the path to ",(0,r.yg)("inlineCode",{parentName:"li"},"ethsigner-x.y.z/bin")," to your system PATH")))),(0,r.yg)("h3",{id:"besu-interoperation-node-sdk"},"Besu Interoperation Node SDK"),(0,r.yg)("p",null,"A client-layer library is defined in the ",(0,r.yg)("inlineCode",{parentName:"p"},"sdks/besu/interoperation-node-sdk")," folder. This contains functions for Besu web3JS based applications to exercise interoperation capabilities via several utility/helper functions. The Besu-CLI tool, which we will use later, depends on this library."),(0,r.yg)("p",null,"To build the library, do the following:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"sdks/besu/interoperation-node-sdk")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following command:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build-local\n")))),(0,r.yg)("h3",{id:"besu-network"},"Besu Network"),(0,r.yg)("p",null,"The code for this lies in the ",(0,r.yg)("inlineCode",{parentName:"p"},"tests/network-setups/besu")," folder."),(0,r.yg)("p",null,"This folder contains code to create and launch networks ",(0,r.yg)("inlineCode",{parentName:"p"},"Network1")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"Network2")," of identical specifications:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Network: 4 validator nodes, 1 EthSigner node."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"Network1")," uses ",(0,r.yg)("inlineCode",{parentName:"li"},"8545")," port for EthSigner while ",(0,r.yg)("inlineCode",{parentName:"li"},"Network2")," uses ",(0,r.yg)("inlineCode",{parentName:"li"},"9544")," port for EthSigner.")),(0,r.yg)("p",null,"Follow the instructions below to build and launch the networks:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"tests/network-setups/besu")," folder."),(0,r.yg)("li",{parentName:"ul"},"To spin up both Network1 and Network2, run:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make start\n")))),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"If you do not wish to test Besu-Besu interoperation, you can choose to launch only one of the two networks. For ",(0,r.yg)("inlineCode",{parentName:"td"},"Network1"),", run ",(0,r.yg)("inlineCode",{parentName:"td"},"make start-network1"),", and for ",(0,r.yg)("inlineCode",{parentName:"td"},"Network2"),", run ",(0,r.yg)("inlineCode",{parentName:"td"},"make start-network2"))))),(0,r.yg)("p",null,"For more information, refer to the associated ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/hyperledger-labs/weaver-dlt-interoperability/tree/main/tests/network-setups/besu"},"README"),"."),(0,r.yg)("h3",{id:"contracts"},"Contracts"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"AssetExchangeContract")," must be deployed which is present in ",(0,r.yg)("inlineCode",{parentName:"li"},"core/network/besu/contracts/interop/manageAssetAny.sol"),". This contract is deployed along with application contract."),(0,r.yg)("li",{parentName:"ul"},"Application contract ",(0,r.yg)("inlineCode",{parentName:"li"},"simpleasset"),", located in ",(0,r.yg)("inlineCode",{parentName:"li"},"samples/besu/simpleasset")," directory (for ",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/getting-started/interop/asset-exchange/overview"},"Asset Exchange"),"), which supports creation, modification, transfer, and deletion, as well as locking, unlocking, and claiming, of simple ",(0,r.yg)("inlineCode",{parentName:"li"},"AliceERC20")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"BobERC20")," tokens (examples of fungible assets), or ",(0,r.yg)("inlineCode",{parentName:"li"},"AliceERC721")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"BobERC721")," tokens (example of non-fungible assets), or ",(0,r.yg)("inlineCode",{parentName:"li"},"AliceERC1155")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"BobERC1155")," tokens (example of hybrid assets).")),(0,r.yg)("p",null,"To deploy ",(0,r.yg)("inlineCode",{parentName:"p"},"simpleasset")," with ",(0,r.yg)("inlineCode",{parentName:"p"},"AssetExchangeContract")," on both Besu networks, navigate to ",(0,r.yg)("inlineCode",{parentName:"p"},"samples/besu/simpleasset")," folder, and run:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make deploy-contracts\n")),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"If you chose to launch only one of the two networks, then for ",(0,r.yg)("inlineCode",{parentName:"td"},"Network1"),", run ",(0,r.yg)("inlineCode",{parentName:"td"},"make deploy-contract-network1"),", and for ",(0,r.yg)("inlineCode",{parentName:"td"},"Network2"),", run ",(0,r.yg)("inlineCode",{parentName:"td"},"deploy-contract-network2"))))),(0,r.yg)("h3",{id:"besu-client-besu-cli"},"Besu Client (besu-cli)"),(0,r.yg)("p",null,"The CLI is used to interact with a Besu network, configure it and run contract transactions to record data on the ledger or query data."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"besu-cli")," Node.js source code is located in the ",(0,r.yg)("inlineCode",{parentName:"p"},"samples/besu/besu-cli")," folder."),(0,r.yg)("h4",{id:"prerequisites-3"},"Prerequisites"),(0,r.yg)("p",null,"If you are using a Linux system, make sure that lib64 is installed."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Notes"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"For the Node.js version of the ",(0,r.yg)("inlineCode",{parentName:"td"},"besu-cli"),", the setup and running instructions below were tested with all Node.js versions from v11.14.0 to v14.17.3.")))),(0,r.yg)("h4",{id:"installation-1"},"Installation"),(0,r.yg)("p",null,"You can install ",(0,r.yg)("inlineCode",{parentName:"p"},"besu-cli")," as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"samples/besu/besu-cli")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following to install dependencies:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make build-local\n"))),(0,r.yg)("li",{parentName:"ul"},"Use the ",(0,r.yg)("inlineCode",{parentName:"li"},"besu-cli")," executable in the ",(0,r.yg)("inlineCode",{parentName:"li"},"bin")," folder for ",(0,r.yg)("a",{parentName:"li",href:"/weaver-dlt-interoperability/docs/external/getting-started/test-network/ledger-initialization"},"subsequent actions"),".")),(0,r.yg)("h2",{id:"tear-down-the-setup"},"Tear Down the Setup"),(0,r.yg)("p",null,"Bring down the test network's components as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Simply terminate the various relays and drivers, which are running in the foreground in different terminals"),(0,r.yg)("li",{parentName:"ul"},"To bring down the running Corda network:",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"tests/network-setups/corda")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make clean\n"))))),(0,r.yg)("li",{parentName:"ul"},"To bring down all the running Fabric networks:",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"tests/network-setups/fabric/dev")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make clean\n"))))),(0,r.yg)("li",{parentName:"ul"},"To bring down all the running Besu networks:",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Navigate to the ",(0,r.yg)("inlineCode",{parentName:"li"},"tests/network-setups/besu")," folder."),(0,r.yg)("li",{parentName:"ul"},"Run the following:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"make clean\n")))))))}c.isMDXComponent=!0}}]);