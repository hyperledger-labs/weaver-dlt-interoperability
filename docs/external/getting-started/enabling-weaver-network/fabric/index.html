<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/weaver-dlt-interoperability/blog/rss.xml" title="Weaver: DLT Interoperability Framework RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/weaver-dlt-interoperability/blog/atom.xml" title="Weaver: DLT Interoperability Framework Atom Feed"><title data-react-helmet="true">Hyperledger Fabric | Weaver: DLT Interoperability Framework</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/fabric"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Hyperledger Fabric | Weaver: DLT Interoperability Framework"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><link data-react-helmet="true" rel="shortcut icon" href="/weaver-dlt-interoperability/shared/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/fabric"><link data-react-helmet="true" rel="alternate" href="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/fabric" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/fabric" hreflang="x-default"><link rel="stylesheet" href="/weaver-dlt-interoperability/assets/css/styles.fe84083a.css">
<link rel="preload" href="/weaver-dlt-interoperability/assets/js/runtime~main.9236cb13.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/assets/js/main.ace5a136.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/weaver-dlt-interoperability/"><div class="navbar__logo"><img src="/weaver-dlt-interoperability/shared/logo.svg" alt="Weaver" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/weaver-dlt-interoperability/shared/logo.svg" alt="Weaver" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Weaver</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/weaver-dlt-interoperability/docs/external/introduction">Docs</a><a class="navbar__item navbar__link" href="/weaver-dlt-interoperability/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/introduction">Weaver Framework</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/weaver-dlt-interoperability/docs/external/getting-started/guide">Using Weaver</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Launching a Test Network</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Testing Interoperation Modes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Enabling Weaver in your Network and Application</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/fabric">Hyperledger Fabric</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/corda">Corda</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/besu">Hyperledger Besu</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What is Interoperability?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/interoperability-modes">Interoperability Modes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/design-principles">Design Principles</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Stories</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture and Design</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security Model</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment Considerations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/specifications">Specifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/publications">Publications</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Hyperledger Fabric</h1></header><p>After testing the Weaver interoperation mechanisms on <a href="/weaver-dlt-interoperability/docs/external/getting-started/test-network/overview">basic sample networks</a>, you may be interested in finding out how you can equip an existing real network, whether in development or in production, to exercise these mechanisms. In this document, we will demonstrate how to equip a Fabric network and application with Weaver components and capabilities.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="model">Model<a aria-hidden="true" class="hash-link" href="#model" title="Direct link to heading">â€‹</a></h2><p>The figure below illustrates a typical Fabric network. The infrastructure consists of a set of peers, ordering service nodes, and CAs that perform the roles of MSPs; each serves a given <em>organization</em> which is one of the constituent units of the network. On the peers are installed one or more smart contracts (<em>chaincode</em>), representing shared business logic across the different organizations. Further up lie the so-called Layer-2 applications that consist of organization-specific business logic and invoke the smart contracts using APIs exposed by the Fabric SDK and with wallet credentials issued by their respective organizations&#x27; CAs.</p><p><img alt="alt text" src="/weaver-dlt-interoperability/assets/images/fabric-network-model-06abc1e93e9ae75bd416b1f822b7a312.png"></p><p>Such a network equipped with Weaver components and capabilities will look like the figure below. Legacy components are marked in grey and Weaver and bridging components in green.</p><p><img alt="alt text" src="/weaver-dlt-interoperability/assets/images/fabric-weaver-model-bf28db3b4df0cd0ecd2a364e6886f91e.png"></p><p>The relay and driver are the only additional infrastructure that need to be installed. One or more relays can be installed, as can one or more drivers. The drivers are illustrated in Layer-2 rather than in the bottom layer because, though they are coupled with relays, they exercise contracts using the Fabric SDK and organization-issued credentials just like any Layer-2 application does.</p><p>Existing chaincode deployed on the network&#x27;s channels remain undisturbed. All that is required in the smart contracts layer is the deployment of the Fabric Interoperation Chaincode on every channel that needs to offer or consume state from foreign networks.</p><p>Layer-2 applications will need some additional code and configuration because the decisions to exercise interoperation mechanisms (relay queries for data sharing or atomic asset exchanges) are strictly part of business logic. But Weaver&#x27;s Fabric Interoperation Node SDK offers various helper functions to ease this process and keep the adaptation to a minimum, as we wil see later in this document. Finally, an <em>identity service</em> must be offered by the network to expose its CAs&#x27; certificate chains to foreign networks, thereby laying the basis for interoperation. This service simply needs to offer a REST endpoint, and can be implemented as a standalone application or (more conveniently) as an augmentation of one or more of the existing Layer-2 applications.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="procedure">Procedure<a aria-hidden="true" class="hash-link" href="#procedure" title="Direct link to heading">â€‹</a></h2><p>Let us walk through the changes that are required in different phases of your network&#x27;s creation.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="development">Development<a aria-hidden="true" class="hash-link" href="#development" title="Direct link to heading">â€‹</a></h3><p>A Fabric distributed application&#x27;s business logic code spans two layers as illustrated in the network model:</p><ul><li><p><em>Chaincode</em>: </p><ul><li><p><em>Data Sharing</em>: No code changes are required for Weaver enablement, as mentioned above.</p></li><li><p><em>Asset Exchange</em>: Asset exchange can be enabled in two ways, either use weaver <a href="https://pkg.go.dev/github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/libs/assetexchange" target="_blank" rel="noopener noreferrer"><code>assetexchange</code></a> as library, or use interop chaincode to handle asset exchange by doing a chaincode to chaincode call.</p><ul><li><p><em>Use Library <!-- -->[<code>assetexchange</code>]<!-- -->(<a href="https://pkg.go.dev/github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/libs/assetexchange" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/libs/assetexchange</a></em>: This method doesn&#x27;t require <a href="https://pkg.go.dev/github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/contracts/interop" target="_blank" rel="noopener noreferrer"><code>interop</code></a> chaincode to be installed. In you smart contract <code>go.mod</code>, add following in require (update the version according to the latest module version):</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">require(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    github.com/hyperledger-labs/weaver-dlt-interoperability/common/protos-go v1.5.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/libs/assetexchange v1.5.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Atleast following 5 functions needs to be added in chaincode (Note: the function signature, i.e. the name,  arguments and return values needs to be exactly same):</p><ol><li><p><strong>LockAsset</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/libs/assetexchange&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">LockAsset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> assetExchangeAgreementSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lockInfoSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Add some safety checks before calling LockAsset from library</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Caller of this chaincode is supposed to be the Locker and the owner of the asset being locked.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> assetexchange</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">LockAsset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> assetExchangeAgreementSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lockInfoSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">logThenErrorf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Post proccessing of asset after LockAsset called like change status of the asset so that it can&#x27;t be spent.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here <code>assetExchangeAgreementSerializedProto64</code> is serialized protobuf in base64 encoded string of <code>AssetExchangeAgreement</code> protobuf structure, and can be used to extract details like asset id, type of asset and recipient. Check the structure definition <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/rfcs/formats/assets/exchange.md#representing-two-party-asset-exchange-agreements" target="_blank" rel="noopener noreferrer">here</a>.
Similarly <code>lockInfoSerializedProto64</code> is serialized protobuf in base64 encoded string of <code>AssetLock</code> protobuf structure. Check the structure definition <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/rfcs/formats/assets/exchange.md#representing-locks-on-assets" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p><strong>LockFungibleAsset</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">LockFungibleAsset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fungibleAssetExchangeAgreementSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lockInfoSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Add some safety checks before calling LockFungibleAsset from library</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Caller of this chaincode is supposed to be the Locker and the owner of the asset being locked.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> assetexchange</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">LockFungibleAsset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fungibleAssetExchangeAgreementSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lockInfoSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">logThenErrorf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Post proccessing of asset after LockFungibleAsset called like reduce the amount of tokens owned by the locker, or mark it locked so that it can&#x27;t be spent.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here <code>fungibleAssetExchangeAgreementSerializedProto64</code> is serialized protobuf in base64 encoded string of <code>FungibleAssetExchangeAgreement</code> protobuf structure, and can be used to extract details like asset quantity, type of asset and recipient. Check the structure definition <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/rfcs/formats/assets/exchange.md#representing-two-party-asset-exchange-agreements" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p><strong>IsAssetLockedQueryUsingContractId</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">IsAssetLockedQueryUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> assetexchange</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">IsAssetLockedQueryUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p><strong>ClaimAssetUsingContractId</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ClaimAssetUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> claimInfoSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Note recipient will be the caller for this function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    claimed </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> assetexchange</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ClaimAssetUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> claimInfoSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">logThenErrorf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    claimed </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// After the above function call, update the owner of the asset with recipeint/caller</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> claimed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p><strong>UnlockAssetUsingContractId</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">UnlockAssetUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    unlocked </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> assetexchange</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">UnlockAssetUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">logThenErrorf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    unlocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>Add following extra utility functions as well:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">GetHTLCHashByContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> assetexchange</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">GetHTLCHashByContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">GetHTLCHashPreImageByContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> assetexchange</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">GetHTLCHashPreImageByContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ol><p>There is an alternative API to implement asset exchange using this library, which doesn&#x27;t involve contractIds For details <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/network/fabric-interop-cc/libs/assetexchange/README.md#without-contractid" target="_blank" rel="noopener noreferrer">read here</a>.
</p></li><li><p><em>Use <a href="https://pkg.go.dev/github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/contracts/interop" target="_blank" rel="noopener noreferrer"><code>Interop</code></a> Chaincode</em>: This method requires <code>interop</code> chaincode to be installed on all peers of the channel. Application chaincode needs to implement the interface <code>github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/interfaces/asset-mgmt</code>.
In you smart contract <code>go.mod</code>, add following in require (update the version according to the latest module version):</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">require(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    github.com/hyperledger-labs/weaver-dlt-interoperability/common/protos-go v1.5.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/interfaces/asset-mgmt v1.5.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the Smart Contract struct add following code:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    am </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/interfaces/asset-mgmt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> SmartContract </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Contract</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    amc am</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">AssetManagementContract</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Following functions needs to be implemented in chaincode (Note: the function signature, i.e. the name,  arguments and return values needs to be exactly same):</p><ol><li><p><strong>LockAsset</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">LockAsset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> assetExchangeAgreementSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lockInfoSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Add some safety checks before calling LockAsset from library</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Caller of this chaincode is supposed to be the Locker and the owner of the asset being locked.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">amc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">LockAsset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> assetExchangeAgreementSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lockInfoSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">logThenErrorf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Post proccessing of asset after LockAsset called like change status of the asset so that it can&#x27;t be spent.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here <code>assetExchangeAgreementSerializedProto64</code> is serialized protobuf in base64 encoded string of <code>AssetExchangeAgreement</code> protobuf structure, and can be used to extract details like asset id, type of asset and recipient. Check the structure definition <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/rfcs/formats/assets/exchange.md#representing-two-party-asset-exchange-agreements" target="_blank" rel="noopener noreferrer">here</a>.
Similarly <code>lockInfoSerializedProto64</code> is serialized protobuf in base64 encoded string of <code>AssetLock</code> protobuf structure. Check the structure definition <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/rfcs/formats/assets/exchange.md#representing-locks-on-assets" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p><strong>LockFungibleAsset</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">LockFungibleAsset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fungibleAssetExchangeAgreementSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lockInfoSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Add some safety checks before calling LockFungibleAsset from library</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Caller of this chaincode is supposed to be the Locker and the owner of the asset being locked.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">amc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">LockFungibleAsset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fungibleAssetExchangeAgreementSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lockInfoSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">logThenErrorf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Post proccessing of asset after LockFungibleAsset called like reduce the amount of tokens owned by the locker, or mark it locked so that it can&#x27;t be spent.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here <code>fungibleAssetExchangeAgreementSerializedProto64</code> is serialized protobuf in base64 encoded string of <code>FungibleAssetExchangeAgreement</code> protobuf structure, and can be used to extract details like asset quantity, type of asset and recipient. Check the structure definition <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/rfcs/formats/assets/exchange.md#representing-two-party-asset-exchange-agreements" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p><strong>IsAssetLockedQueryUsingContractId</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">IsAssetLockedQueryUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">amc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">IsAssetLockedQueryUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p><strong>ClaimAssetUsingContractId</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ClaimAssetUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> claimInfoSerializedProto64 </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Note recipient will be the caller for this function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    claimed </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">amc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ClaimAssetUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> claimInfoSerializedProto64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">logThenErrorf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    claimed </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// After the above function call, update the owner of the asset with recipeint/caller</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> claimed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p><strong>UnlockAssetUsingContractId</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">SmartContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">UnlockAssetUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx contractapi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TransactionContextInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    unlocked </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">amc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">UnlockAssetUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">logThenErrorf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    unlocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ol></li></ul></li><li><p><em>Asset Transfer</em>: <em>TBD</em></p></li></ul></li><li><p><em>Client (or Layer-2) applications</em>: Let us examine the adaptations required in detail:</p><p>All the application changes require weaver SDK, so first you need to add the following dependency to the <code>dependencies</code> section of your application&#x27;s <code>package.json</code> file:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token property">&quot;@hyperledger-labs/weaver-fabric-interop-sdk&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;latest&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>(Or check out the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/packages/888424" target="_blank" rel="noopener noreferrer">package website</a> and select a different version.)</p><p>Before you run <code>npm install</code> to fetch the dependencies, make sure you create a <a href="https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">personal access token</a> with <code>read:packages</code> access in Github. Create an <code>.npmrc</code> file in the same folder as the <code>package.json</code> with the following contents:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">registry=https://npm.pkg.github.com/hyperledger-labs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//npm.pkg.github.com/:_authToken=&lt;personal-access-token&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Replace <code>&lt;personal-access-token&gt;</code> in this file with the token you created in Github.</p><ul><li><p><strong>Identity Service</strong>: A Fabric network needs to share its security domain (or membership) configuration, i.e., its organizations&#x27; CA certificate chains, with a foreign network with which it seeks to interoperate. (You will need one service per channel.). IIN Agents does automatic sync of membership. But before setting up IIN Agents, <em>local membership</em> needs to be recorded in the ledger. Following code snipper needs to be added in application to enable this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> gateway </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">get</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">fabric</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">network</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">gateway</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">instance</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> MembershipManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createLocalMembership</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        gateway</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        members</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// list of all organization MSPIDs that are part of the channel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        securityDomain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// name of the local network&#x27;s security domain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        channelName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Channel Name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        contractName    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Interop chaincode name set during installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// On error try updating local membership</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> MembershipManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">updateLocalMembership</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">gateway</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> members</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> securityDomain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> channelName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p><strong>Interoperation Helpers</strong>: Your Fabric network&#x27;s Layer-2 applications have business logic embedded in them that, broadly speaking, accept data from users and other external agents and invoke smart contracts using library functions and APIs offered by the Fabric SDK. With the option of interoperability with other networks available through Weaver, other options can be added, namely requesting and accepting data from foreign networks, and triggering locks and claims for atomic exchanges spanning two networks. Weaver&#x27;s Fabric Interoperation SDK (currently implemented both in Node.js and Golang) offers a library to exercise these options, supplementing the Fabric SDK. But this will involve modification to the application&#x27;s business logic. The following examples will illustrate how you can adapt your applications.</p><ul><li><p><em>Data Sharing</em>: Consider a scenario inspired by the <a href="/weaver-dlt-interoperability/docs/external/user-stories/global-trade">global trade use case</a> where a letter of credit (L/C) management business logic (chaincode <code>letterofcreditcc</code>) installed in the <code>tradefinancechannel</code> channel in the <code>trade-finance-network</code> network supports a transaction <code>RecordBillOfLading</code>, which validates and records a bill of lading (B/L) supplied by a user via a UI. Weaver will enable such a B/L to be fetched from a different network <code>trade-logistics-network</code> by querying the function <code>GetBillOfLading</code> exposed by the chaincode <code>shipmentcc</code> installed in the <code>tradelogisticschannel</code> channel.</p><p>(In preparation, a suitable access control policy must be recorded on <code>tradelogisticschannel</code> in <code>trade-logistics-network</code>, and a suitable verification policy must be recorded on <code>tradefinancechannel</code> in <code>trade-finance-network</code>. We will see how to do this in the &quot;Startup and Boostrap&quot; section later.)</p><p>You will need to insert some code in the Layer-2 application that accepts a B/L and submits a <code>RecordBillOfLading</code> transaction in <code>trade-finance-network</code>. (No code changes need to be made in any application in the other network.) The logic to accept a B/L should be replaced (or you can simply add an alternative) by a call to the <code>interopFlow</code> function offered by the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/packages/888424" target="_blank" rel="noopener noreferrer">weaver-fabric-interop-sdk</a> library (there&#x27;s an <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/releases/tag/sdks%2Ffabric%2Fgo-sdk%2Fv1.2.3-alpha.1" target="_blank" rel="noopener noreferrer">equivalent library in Golang</a> too). The following code sample illustrates this (the Golang equivalent is left to the reader):</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> ihelper </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@hyperledger-labs/weaver-fabric-interop-sdk&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">InteroperableHelper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> interopcc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">fabric</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">interop</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">chaincode</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Use Fabric SDK functions: (new Gateway()).getNetwork(...).getContract(&lt;fabric-interop-chaincode-id&gt;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> keyCert </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> ihelper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getKeyAndCertForRemoteRequestbyUserName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">wallet</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">user</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">id</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Read key and certificate for &lt;user-id&gt; from wallet (get handle using Fabric SDK Wallets API)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Collect view addresses for relay requests in the context of an interop flow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">interopJSONs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">NetworkID</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;trade-logistics-network&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">RemoteEndpoint</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">trade</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">logistics</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">relay</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">port</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Replace with remote network&#x27;s relay address and port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">ChannelID</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;tradelogisticschannel&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">ChaincodeID</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;shipmentcc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">ChaincodeFunc</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;GetBillOfLading&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">ccArgs</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">shipment</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">reference</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Replace &lt;shipment-reference&gt; with a value that can be used to look up the right B/L</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token literal-property property">Sign</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> indices </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Trigger an end-to-end interoperation (data sharing) protocol</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Send a request to a foreign network via your relay, receive the response and submit a transaction to a local chaincode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> flowResponse </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> ihelper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">interopFlow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    interopcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;trade-finance-network&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">channel</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;tradefinancechannel&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">contractName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;letterofcreditcc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">ccFunc</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;RecordBillOfLading&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token literal-property property">ccArgs</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">shipment</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">reference</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">org</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">msp</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">id</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Replace with this Layer-2 application&#x27;s organization&#x27;s MSP ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">trade</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">finance</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">relay</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">port</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Replace with local network&#x27;s relay address and port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    indices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    interopJSONs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    keyCert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// List of errors to check for</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">flowResponse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">views</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> flowResponse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">views</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">flowResponse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">result</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> flowResponse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">views</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!==</span><span class="token plain"> argIndices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">throw</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">error</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Let us understand this code snippet better. The structure in lines 156-161 specifies the local chaincode transaction that is to be triggered after remote data (view) has been requested and obtained via relays. The function <code>RecordBillOfLading</code> expects two arguments as specified in line 160: the first is the common shipment reference that is used by the letter of credit in <code>trade-finance-network</code> and the bill of lading in <code>trade-logistics-network</code>, and the second is the bill of lading contents. When the <code>interopFlow</code> function is called, this argument is left blank because it is supposed to be filled with contents obtained from a view request. The array list <code>indices</code>, which is passed as an argument to <code>interopFlow</code> therefore contains the index value <code>1</code> (line 150), indicating which argument ought to be substituted  with view data. The <code>interopJSONs</code> array correspondingly contains a list of view addresses that are to be supplied to the relay.</p><table><thead><tr><th align="left">Notes</th></tr></thead><tbody><tr><td align="left">A local chaincode invocation may require multiple view requests to different networks, which is why <code>indices</code> and <code>interopJSONs</code> are arrays; they therefore must have the same lengths.</td></tr></tbody></table><p>The rest of the code ought to be self-explanatory. Values are hardcoded for explanation purposes, but you can refactor the above code by reading view addresses corresponding to chaincode invocations from a configuration file.</p></li><li><p><em>Asset Exchange</em>: Let&#x27;s take an example of asset exchange between <code>Alice</code> and <code>Bob</code>, where Bob wants to purchase an asset of type <code>Gold</code> with id <code>A123</code> from <code>Alice</code> in <code>BondNetwork</code> in exchange for <code>200</code> tokens of type <code>CBDC01</code> in <code>TokenNetwork</code>.</p><p><code>Alice</code> needs to select a secret text (say <code>s</code>), and hash it (say <code>H</code>) using say <code>SHA512</code>, which will be used to lock her asset in <code>BondNetwork</code>. To lock the non-fungible asset using hash <code>H</code> and timeout duration of 10 minutes, you need to add following code snippet in your application:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> AssetManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> HashFunctions </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@hyperledger-labs/weaver-fabric-interop-sdk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> hash </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> HashFunctions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">SHA512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Create Hash instance of one of the supported Hash Algorithm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setSerializedHashBase64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">H</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Set the Hash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> timeout </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">floor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">now</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> bondContract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">fabric</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">application</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">chaincode</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">in</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">bond</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">network</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> AssetManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createHTLC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bondContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Gold&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">             </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Asset ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;A123&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">             </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Asset Type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bobCertificate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Certificate of Bob in Bond Network</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Hash generated by Alice using her secret s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Timeout in epoch for 10 mins from current time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">null</span><span class="token plain">                </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Optional callback function to be called after the asset is locked</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> bondContractId </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Unique ID for this asset exchange contract in BondNetwork</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now <code>Bob</code> will lock his tokens in <code>TokenNetwork</code>. To lock the fungible asset using same hash <code>H</code> and timeout of 5 minutes (half the timeout duration used by Alice in <code>BondNetwork</code>), add following code snippet in your application:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> hash </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> HashFunctions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">SHA512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Create Hash instance of one of the supported Hash Algorithm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setSerializedHashBase64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">H</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Set the Hash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> timeout </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">floor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">now</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> tokenContract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">fabric</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">application</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">chaincode</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">in</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">token</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">network</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> AssetManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createFungibleHTLC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tokenContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CBDC01&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">               </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Token ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Token Quantity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    aliceCertificate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Certificate of Alice in Token Network</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Hash H used by Alice in Bond Network</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Timeout in epoch for 5 mins from current time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">null</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Optional callback function to be called after the asset is locked</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> tokenContractId </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">result </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Unique ID for this asset exchange contract in TokenNetwork</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To query whether the assets are locked or not in any network, use following query function:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">fabric</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">application</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">chaincode</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Below contractId is the ID obtained during lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AssetManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">isAssetLockedInHTLCqueryUsingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now to claim the asset using the secret text (pre-image of hash) <code>s</code>, add following code snippet:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> hash </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> HashFunctions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">SHA512</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Create Hash instance of one of the supported Hash Algorithm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPreimage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">                     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Set Pre-Image s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">fabric</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">application</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">chaincode</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> claimSuccess </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> AssetManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">claimAssetInHTLCusingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">                         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// contractId obtained during lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// return value claimSuccess is boolean indicating success or failure of claim</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If the asset has to be unlocked, use following code snippet:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">handle</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">fabric</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">application</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">chaincode</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> reclaimSuccess </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> AssetManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">reclaimAssetInHTLCusingContractId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contractId                          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// contractId obtained during lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// return value reclaimSuccess is boolean indicating success or failure of reclaim</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p><em>Asset Transfer</em>: <em>TBD</em></p></li></ul></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="pre-configuration">Pre-Configuration<a aria-hidden="true" class="hash-link" href="#pre-configuration" title="Direct link to heading">â€‹</a></h3><p>No changes are required in your network&#x27;s pre-configuration process for Weaver enablement.</p><p>Typically, pre-configuration involves generating:</p><ul><li><em>Channel artifacts</em>: orderer genesis block, channel transaction, and anchor peer configurations from a <code>configtx.yaml</code> file (using Fabric&#x27;s <code>configtxgen</code> tool)</li><li><em>Crypto artifacts</em>: keys and certificates for CAs, peers, orderers, and clients from a <code>crypto-config.yaml</code> file (using Fabric&#x27;s <code>cryptogen</code> tool)</li><li><em>Connection profiles</em>: one for every network organization, which will be used by the organization&#x27;s Layer-2 applications to connect to the network&#x27;s peers and CAs</li></ul><p>Only a connection profile will be used by Weaver, as we will see later.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="startup-and-bootstrap-asset-exchange">Startup and Bootstrap: Asset Exchange<a aria-hidden="true" class="hash-link" href="#startup-and-bootstrap-asset-exchange" title="Direct link to heading">â€‹</a></h3><p>To launch a network using containerized components, you will typically use a Docker Compose or Kubernetes configuration file. No modifications are needed to the peers&#x27;, orderers&#x27;, and CAs&#x27; configurations. Sample instructions are given below for networks launched using Docker Compose; we leave it to the reader to adapt these to their custom launch processes.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="install-the-fabric-interoperation-chaincode">Install the Fabric Interoperation Chaincode<a aria-hidden="true" class="hash-link" href="#install-the-fabric-interoperation-chaincode" title="Direct link to heading">â€‹</a></h4><p>Install the Fabric Interoperation Chaincode in the relevant channel(s), i.e., those that run smart contracts that will be involved in any interoperation mode. This is a Go module that can be fetched from <code>github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/contracts/interop</code>. Following that, you an install it using the appropriate Fabric process: in Fabric v2, you will need to package, install, approve, and commit this module on the selected channels in your network.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="startup-and-bootstrap-data-sharing--asset-transfer">Startup and Bootstrap: Data Sharing &amp; Asset Transfer<a aria-hidden="true" class="hash-link" href="#startup-and-bootstrap-data-sharing--asset-transfer" title="Direct link to heading">â€‹</a></h3><p>To launch a network using containerized components, you will typically use a Docker Compose or Kubernetes configuration file. No modifications are needed to the peers&#x27;, orderers&#x27;, and CAs&#x27; configurations. Sample instructions are given below for networks launched using Docker Compose; we leave it to the reader to adapt these to their custom launch processes.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="install-the-fabric-interoperation-chaincode-1">Install the Fabric Interoperation Chaincode<a aria-hidden="true" class="hash-link" href="#install-the-fabric-interoperation-chaincode-1" title="Direct link to heading">â€‹</a></h4><p>Install the Fabric Interoperation Chaincode in the relevant channel(s), i.e., those that run smart contracts that will be involved in any interoperation mode. This is a Go module that can be fetched from <code>github.com/hyperledger-labs/weaver-dlt-interoperability/core/network/fabric-interop-cc/contracts/interop</code>. Following that, you an install it using the appropriate Fabric process: in Fabric v2, you will need to package, install, approve, and commit this module on the selected channels in your network.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="launch-relay">Launch Relay<a aria-hidden="true" class="hash-link" href="#launch-relay" title="Direct link to heading">â€‹</a></h4><p>You can start a relay within a Docker container using a <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/pkgs/container/weaver-relay-server" target="_blank" rel="noopener noreferrer">pre-built image</a>. You just need to customize the container configuration for your Fabric network, which you can do by simply creating a folder (let&#x27;s call it <code>relay_config</code>) and configuring the following files in it:</p><ul><li><p><code>.env</code>: This sets suitable environment variables within the relay container. Copy the <code>.env.template</code> file <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/relay/.env.template" target="_blank" rel="noopener noreferrer">from the repository</a> and customize it for your purposes, as indicated in the below sample:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">PATH_TO_CONFIG=./config.toml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RELAY_NAME=&lt;&quot;name&quot; in config.toml&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RELAY_PORT=&lt;relay-server-port/&quot;port&quot; in config.toml&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXTERNAL_NETWORK=&lt;docker-bridge-network&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_REGISTRY=ghcr.io/hyperledger-labs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_IMAGE_NAME=weaver-relay</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_TAG=1.2.4</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>PATH_TO_CONFIG</code> variable should point to the <code>config.toml</code> (you can name this whatever you wish) specified below.</p><p>The <code>RELAY_NAME</code> variable specifies a unique name for this relay. It should match what&#x27;s specified in the <code>config.toml</code> (more on that below).</p><p>The <code>RELAY_PORT</code> variable specifies the port this relay server will listen on. It should match what&#x27;s specified in the <code>config.toml</code> (more on that below).</p><p>The <code>EXTERNAL_NETWORK</code> variable should be set to the <a href="https://docs.docker.com/compose/networking/" target="_blank" rel="noopener noreferrer">name</a> of your Fabric network.</p><p>The <code>DOCKER_*</code> variables are used to specify the image on which the container will be built. Make sure you set <code>DOCKER_TAG</code> to the latest version you see on <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/pkgs/container/weaver-relay-server" target="_blank" rel="noopener noreferrer">Github</a>.</p><p>For more details, see the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/relay/relay-docker.md" target="_blank" rel="noopener noreferrer">Relay Docker README</a> (&quot;Relay Server Image&quot; and &quot;Running With Docker Compose&quot; sections).</p></li><li><p><code>config.toml</code>: This specifies properties of the relay and the driver(s) is associates with. A sample is given below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">name=&lt;relay-name&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port=&lt;relay-port&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">host=&quot;0.0.0.0&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">db_path=&quot;db/&lt;relay-name&gt;/requests&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">remote_db_path=&quot;db/&lt;relay-name&gt;/remote_request&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># FOR TLS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cert_path=&quot;credentials/fabric_cert.pem&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">key_path=&quot;credentials/fabric_key&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tls=&lt;true/false&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[networks]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[networks.&lt;network-name&gt;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">network=&quot;&lt;driver-name&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[relays]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[relays.&lt;foreign-relay-name&gt;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hostname=&quot;&lt;foreign-relay-hostname-or-ip-address&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port=&quot;&lt;foreign-relay-port&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[drivers]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[drivers.&lt;driver-name&gt;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hostname=&quot;&lt;driver-hostname-or-ip-address&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port=&quot;&lt;driver-port&gt;&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>&lt;relay-name&gt;</code> should be a unique ID representing this relay; e.g., <code>my_network_relay</code>. It should match the <code>RELAY_NAME</code> value in <code>.env</code>.</p><p><code>&lt;relay-port&gt;</code> is the port number the relay server will listen on. It should match the <code>RELAY_PORT</code> value in <code>.env</code>.</p><p><code>db_path</code> and <code>remote_db_path</code> are used internally by the relay to store data. Replace <code>&lt;relay-name&gt;</code> with the same value set for the <code>name</code> parameter. (These can point to any filesystem paths in the relay&#x27;s container.)</p><p>If you set <code>tls</code> to <code>true</code>, the relay will enforce TLS communication. The <code>cert_path</code> and <code>key_path</code> should point to a Fabric TLS certificate and key respectively, such as those created using the <code>cryptogen</code> tool.</p><p><code>&lt;network-name&gt;</code> is a unique identifier for your local network. You can set it to whatever value you wish.</p><p><code>&lt;driver-name&gt;</code> refers to the driver used by this relay to respond to requests. This also refers to one of the drivers&#x27;s specifications in the <code>drivers</code> section further below. In this code snippet, we have defined one driver. (The names in lines 234 and 242 must match.) In lines 243 and 244, you should specify the hostname and port for the driver (whose configuration we will handle later).</p><p>The <code>relays</code> section specifies all foreign relays this relay can connect to. The <code>&lt;foreign-relay-name&gt;</code> value should be a unique ID for a given foreign relay, and this value will be used by your Layer-2 applications when constructing view addresses for data sharing requests. In lines 238 and 239, you should specify the hostname and port for the foreign relay.</p><table><thead><tr><th align="left">Notes</th></tr></thead><tbody><tr><td align="left">You can specify more than one driver instance in the <code>drivers</code> section.</td></tr><tr><td align="left">You can specify more than one foreign relay instance in the <code>relays</code> section.</td></tr></tbody></table></li><li><p><code>docker-compose.yaml</code>: This specifies the properties of the relay container. You can use the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/relay/docker-compose.yaml" target="_blank" rel="noopener noreferrer">file in the repository</a> verbatim.</p></li></ul><p>To start the relay server, navigate to the folder containing the above files and run the following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker-compose</span><span class="token plain"> up -d relay-server</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="launch-driver">Launch Driver<a aria-hidden="true" class="hash-link" href="#launch-driver" title="Direct link to heading">â€‹</a></h4><p>You can start a driver within a Docker container using a <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/pkgs/container/weaver-fabric-driver" target="_blank" rel="noopener noreferrer">pre-built image</a>. You just need to customize the container configuration for your Fabric network, which you can do by simply creating a folder (let&#x27;s call it <code>driver_config</code>) and configuring the following files in it:</p><ul><li><p><code>.env</code>: This sets suitable environment variables within the driver container. Copy the <code>.env.template</code> file <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/drivers/fabric-driver/.env.docker.template" target="_blank" rel="noopener noreferrer">from the repository</a> and customize it for your purposes, as indicated in the below sample:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONNECTION_PROFILE=&lt;path_to_connection_profile&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DRIVER_CONFIG=./config.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RELAY_ENDPOINT=&lt;relay-hostname&gt;:&lt;relay-port&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NETWORK_NAME=&lt;network-name&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DRIVER_PORT=&lt;driver-server-port&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INTEROP_CHAINCODE=&lt;interop-chaincode-name&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXTERNAL_NETWORK=&lt;docker-bridge-network&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_IMAGE_NAME=weaver-fabric-driver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_TAG=1.2.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_REGISTRY=ghcr.io/hyperledger-labs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>&lt;path_to_connection_profile&gt;</code> should point to the path of a connection profile you generated in the &quot;Pre-Configuration&quot; section. A Fabric driver obtains client credentials from one of the organizations in your network, so pick an organization and point to the right connection profile.</p><p>The <code>DRIVER_CONFIG</code> variable should point to the <code>config.json</code> (you can name this whatever you wish) specified below.</p><p><code>&lt;relay-hostname&gt;</code> should be set to the hostname of the relay server machine and <code>&lt;relay-port&gt;</code> should match the <code>port</code> value in the relay&#x27;s <code>config.toml</code> (see above).</p><p>The <code>NETWORK_NAME</code> variable should be a unique ID referring to the Fabric network. It will be used to distinguish container names and wallet paths. (This setting is relevant in situations where a driver is used to query multiple network channels.)</p><p>The <code>DRIVER_PORT</code> variable should be set to the port this driver will listen on.</p><p>The <code>INTEROP_CHAINCODE</code> variable should be set to the ID of the Fabric Interop Chaincode installed on your Fabric network channel.</p><p>The <code>EXTERNAL_NETWORK</code> variable should be set to the <a href="https://docs.docker.com/compose/networking/" target="_blank" rel="noopener noreferrer">name</a> of your Fabric network.</p></li><li><p><code>config.json</code>: This contains settings used to connect to a CA of a Fabric network organization and enroll a client. A sample is given below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;admin&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;admin&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;secret&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;adminpw&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;relay&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;relay&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;affiliation&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;affiliation&gt;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;role&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;client&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;attrs&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;relay&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token property">&quot;value&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token property">&quot;ecert&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;mspId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;msp-id&gt;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;caUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;ca-service-endpoint&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As in the <code>.env</code> configuration, you should pick an organization for the driver to associate with. The <code>admin</code> section specifies the registrar name and password (this should be familiar to any Fabric network administrator) used to enroll clients. Default values of <code>admin</code> and <code>adminpw</code> are specified above as examples, which you should replace with the right values configured in your network organization&#x27;s CA.</p><p><code>&lt;affiliation&gt;</code> should be what&#x27;s specified in your organization&#x27;s Fabric CA server configuration. The default is <code>org1.department1</code>, but you should look up the appropriate value from the CA server&#x27;s configuration file.</p><p><code>&lt;msp-id&gt;</code> should be set to the (or an) MSP ID of the selected organization.</p><p><code>&lt;ca-service-endpoint&gt;</code> should be set to the CA server&#x27;s endpoint. If you launched your CA server as a container from a docker-compose file, this should be set to the container&#x27;s service name.</p><table><thead><tr><th align="left">Notes</th></tr></thead><tbody><tr><td align="left">If your connection profile already contains specifications for a CA server, you can leave the <code>&lt;ca-service-endpoint&gt;</code> value as a blank.</td></tr></tbody></table></li><li><p><code>docker-compose.yaml</code>: This specifies the properties of the driver container. You can use the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/drivers/fabric-driver/docker-compose.yml" target="_blank" rel="noopener noreferrer">file in the repository</a> verbatim.</p></li></ul><p>To start the driver, navigate to the folder containing the above files and run the following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker-compose</span><span class="token plain"> up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="launch-iin-agents">Launch IIN Agents<a aria-hidden="true" class="hash-link" href="#launch-iin-agents" title="Direct link to heading">â€‹</a></h4><p>You need to launch one IIN agent for each organization. To launch an IIN agent within a Docker container using a :</p><ol><li>You can use <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/pkgs/container/weaver-iin-agent" target="_blank" rel="noopener noreferrer">weaver-iin-agent</a> image.</li><li>Before starting the IIN agent container, you need to customize the container configuration, which you can do by simply creating a folder (let&#x27;s call it <code>iin_agent_config_&lt;orgname&gt;</code>) and configuring the following files in it:</li></ol><ul><li><p><code>config.json</code>: This contains settings used to connect to a Fabric network organization and its CA. A sample is given below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;admin&quot;:{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;:&quot;admin&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;secret&quot;:&quot;adminpw&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;agent&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;:&quot;iin-agent&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;affiliation&quot;:&quot;&lt;affiliation&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;role&quot;: &quot;client&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;attrs&quot;: [{ &quot;name&quot;: &quot;iin-agent&quot;, &quot;value&quot;: &quot;true&quot;, &quot;ecert&quot;: true }]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;mspId&quot;:&quot;&lt;msp-id&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;ordererMspIds&quot;: [&lt;list-of-orderer-msp-ids&gt;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;ccpPath&quot;: &quot;&lt;path-to-connection-profile&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;walletPath&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;caUrl&quot;: &quot;&lt;ca-service-endpoint&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;local&quot;: &quot;false&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p><code>dnsconfig.json</code>: This defines list of known IIN agents for both local and foreign networks. A sample DNS configuration file is given below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&lt;securityDomainName1&gt;&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&lt;iin-agent1-name&gt;&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;endpoint&quot;: &quot;&lt;hostname:port&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tls&quot;: &lt;true/false&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tlsCACertPath&quot;: &quot;&lt;cacert-path-or-empty-string&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&lt;iin-agent2-name&gt;&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;endpoint&quot;: &quot;&lt;hostname:port&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tls&quot;: &lt;true/false&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tlsCACertPath&quot;: &quot;&lt;cacert-path-or-empty-string&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&lt;securityDomainName2&gt;&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&lt;iin-agent1-name&gt;&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;endpoint&quot;: &quot;&lt;hostname:port&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tls&quot;: &lt;true/false&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tlsCACertPath&quot;: &quot;&lt;cacert-path-or-empty-string&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&lt;iin-agent2-name&gt;&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;endpoint&quot;: &quot;&lt;hostname:port&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tls&quot;: &lt;true/false&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tlsCACertPath&quot;: &quot;&lt;cacert-path-or-empty-string&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>For each security domain, there&#x27;s a JSON object which contains elements with key as iin-agent&#x27;s name, which can be Org MSP Id for Fabric, and value as another JSON object. This value contains <code>endpoint</code> for the iin-agent, boolean <code>tls</code> which is true if TLS is enabled for that iin-agent, and <code>tlsCACertPath</code> which specifies the path to file containing TLS CA certs, keep it empty string if not known.</p></li><li><p><code>security-domain-config.json</code>: This config file contains list of security domain defined for the network and its members, i.e. it can be list of organizations or channel name. Sample security domain configuration file:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&lt;securityDomainName1&gt;&quot;: &quot;&lt;channelName&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&lt;securityDomainName2&gt;&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&lt;Org1MSPId&gt;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;&lt;Org2MSPId&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p><code>.env</code>: This sets suitable environment variables within the driver container. Copy the <code>.env.template</code> file <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/identity-management/iin-agent/.env.docker.template" target="_blank" rel="noopener noreferrer">from the repository</a> and customize it for your purposes, as indicated in the below sample:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">IIN_AGENT_PORT=&lt;iin-agent-server-port&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IIN_AGENT_TLS=&lt;true/false&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IIN_AGENT_TLS_CERT_PATH=&lt;path_to_tls_cert_pem_for_iin_agent&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IIN_AGENT_TLS_KEY_PATH=&lt;path_to_tls_key_pem_for_iin_agent&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MEMBER_ID=&lt;org-msp-id&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SECURITY_DOMAIN=network1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DLT_TYPE=fabric</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONFIG_PATH=./config.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DNS_CONFIG_PATH=./dnsconfig.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SECURITY_DOMAIN_CONFIG_PATH=./security-domain-config.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WEAVER_CONTRACT_ID=&lt;name-of-weaver-interop-chaincode-installed&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SYNC_PERIOD=&lt;repeated_auto_sync_interval&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AUTO_SYNC=&lt;true/false&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TLS_CREDENTIALS_DIR=&lt;dir-with-tls-cert-and-key&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_IMAGE_NAME=ghcr.io/hyperledger-labs/weaver-iin-agent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_TAG=1.5.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXTERNAL_NETWORK=&lt;docker-bridge-network&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>IIN_AGENT_ENDPOINT</code>: The endpoint at which IIN Agent server should listen. E.g.: <code>0.0.0.0:9500</code></li><li><code>IIN_AGENT_TLS</code>: Set this to <code>true</code> to enable TLS on IIN Agent server</li><li><code>IIN_AGENT_TLS_CERT_PATH</code>: Path to TLS certificate if TLS is enabled</li><li><code>IIN_AGENT_TLS_KEY_PATH</code>: Path to TLS key if TLS is enabled</li><li><code>MEMBER_ID</code>: Member Id for this IIN Agent. For fabric network, it should be the Organization&#x27;s MSP ID</li><li><code>SECURITY_DOMAIN</code>: Security domain to which this IIN Agent belongs</li><li><code>DLT_TYPE</code>: To indicate the type of DLT for which this IIN Agent is running. E.g. <code>fabric</code></li><li><code>CONFIG_PATH</code>: Path to ledger specific config file (explained in next subsection)</li><li><code>DNS_CONFIG_PATH</code>: Path to DNS config file explained in previous sub sections</li><li><code>SECURITY_DOMAIN_CONFIG_PATH</code>: Path to security domain config file explained in previous sub sections</li><li><code>WEAVER_CONTRACT_ID</code>: Contract ID for DLT specific weaver interoperation module installed on network</li><li><code>SYNC_PERIOD</code>: Period at which auto synchronization of memberships from other security domains should happen</li><li><code>AUTO_SYNC</code>: Set this to <code>true</code> to enable auto synchronization of memberships from other security domains</li><li><code>EXTERNAL_NETWORK</code>: Set to the network <a href="https://docs.docker.com/compose/networking/" target="_blank" rel="noopener noreferrer">name</a> of your Fabric network.</li></ul></li><li><p><code>docker-compose.yaml</code>: This specifies the properties of the IIN agent container. You can use the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/identity-management/iin-agent/docker-compose.yml" target="_blank" rel="noopener noreferrer">file in the repository</a> verbatim.</p></li></ul><ol start="3"><li>Now to start the IIN agent, navigate to the folder containing the above files and run the following:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker-compose</span><span class="token plain"> up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To launch an additional IIN agent corresponding to a different organization, repeat the Step 2 and 3 but use a different directory to keep the configuration files and change these specific things:</p><ul><li>Update the organization names everywhere mentioned in <code>config.json</code>.</li><li>Update <code>IIN_AGENT_ENDPOINT</code> and <code>MEMBER_ID</code> in environment variables.</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ledger-initialization">Ledger Initialization<a aria-hidden="true" class="hash-link" href="#ledger-initialization" title="Direct link to heading">â€‹</a></h4><p>To prepare your network for interoperation with a foreign network, you need to record the following to your network channel through the Fabric Interoperation Chaincode:</p><ul><li><p><strong>Access control policies</strong>:
Let&#x27;s take the example of the request made from <code>trade-finance-network</code> to <code>trade-logistics-network</code> for a B/L earlier in this document. <code>trade-logistics-network</code> can have a policy of the following form permitting access to the <code>GetBillOfLading</code> function from a client belonging to the <code>Exporter</code> organization in <code>trade-finance-network</code> as follows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;securityDomain&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;trade-finance-network&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;rules&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;principal&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ExporterMSP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;principalType&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ca&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;resource&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tradelogisticschannel:shipmentcc:GetBillOfLading:*&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;read&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this sample, a single rule is specified for requests coming from <code>trade-finance-network</code>: it states that a <code>GetBillOfLading</code> query made to the <code>shipmentcc</code> contract installed on the <code>tradelogisticschannel</code> channel is permitted for a requestor possessing credentials certified by an MSP with the <code>ExporterMSP</code> identity. The <code>*</code> at the end indicates that any arguments passed to the function will pass the access control check.</p><p>You need to record this policy rule on your Fabric network&#x27;s channel by invoking either the <code>CreateAccessControlPolicy</code> function or the <code>UpdateAccessControlPolicy</code> function on the Fabric Interoperation Chaincode that is already installed on that channel; use the former if you are recording a set of rules for the given <code>securityDomain</code> for the first time and the latter to overwrite a set of rules recorded earlier. In either case, the chaincode function will take a single argument, which is the policy in the form of a JSON string (make sure you escape the double quotes before sending the request to avoid parsing errors). You can do this in one of two ways: (1) writing a small piece of code in Layer-2 that invokes the contract using the Fabric SDK Gateway API, or (2) running a <code>peer chaincode invoke</code> command from within a Docker container built on the <code>hyperledger/fabric-tools</code> image. Either approach should be familiar to a Fabric practitioner.</p></li><li><p><strong>Verification policies</strong>:
Taking the same example as above, an example of a verification policy for a B/L requested by the <code>trade-finance-network</code> from the <code>trade-logistics-network</code> is as follows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;securityDomain&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;trade-logistics-network&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;identifiers&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;pattern&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tradelogisticschannel:shipmentcc:GetBillOfLading:*&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;policy&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Signature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token property">&quot;criteria&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ExporterMSP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CarrierMSP&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this sample, a single verification policy rule is specified for data views coming from <code>trade-logistics-network</code>: it states that the data returned by the <code>GetBillOfLading</code> query made to the <code>shipmentcc</code> chaincode on the <code>tradelogisticschannel</code> channel requires as proof two signatures, one from a peer in the organization whose MSP ID is <code>ExporterMSP</code> and another from a peer in the organization whose MSP ID is <code>CarrierMSP</code>.</p><p>You need to record this policy rule on your Fabric network&#x27;s channel by invoking either the <code>CreateVerificationPolicy</code> function or the <code>UpdateVerificationPolicy</code> function on the Fabric Interoperation Chaincode that is already installed on that channel; use the former if you are recording a set of rules for the given <code>securityDomain</code> for the first time and the latter to overwrite a set of rules recorded earlier. In either case, the chaincode function will take a single argument, which is the policy in the form of a JSON string (make sure you escape the double quotes before sending the request to avoid parsing errors). As with the access control policy, you can do this in one of two ways: (1) writing a small piece of code in Layer-2 that invokes the contract using the Fabric SDK Gateway API, or (2) running a <code>peer chaincode invoke</code> command from within a Docker container built on the <code>hyperledger/fabric-tools</code> image. Either approach should be familiar to a Fabric practitioner.</p><table><thead><tr><th align="left">Notes</th></tr></thead><tbody><tr><td align="left">For any cross-network data request, make sure an access control policy is recorded in the <em>source network</em> (<code>trade-logistics-network</code> in the above example) and a corresponding verification policy is recorded in the <em>destination network</em> (<code>trade-finance-network</code> in the above example) before any relay request is triggered.</td></tr></tbody></table></li><li><p><strong>Local network security domain (membership) configuration</strong>:
Call the function or HTTP endpoint to record local membership that was created in development step.</p></li></ul><p>Your Fabric network is now up and running with the necessary Weaver components, and your network&#x27;s channel&#x27;s ledger is bootstrapped with the initial configuration necessary for cross-network interactions!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/edit/master/docs/external/getting-started/enabling-weaver-network/fabric.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Enabling Weaver in Existing DLT Applications</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/corda"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Corda<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#model" class="table-of-contents__link toc-highlight">Model</a></li><li><a href="#procedure" class="table-of-contents__link toc-highlight">Procedure</a><ul><li><a href="#development" class="table-of-contents__link toc-highlight">Development</a></li><li><a href="#pre-configuration" class="table-of-contents__link toc-highlight">Pre-Configuration</a></li><li><a href="#startup-and-bootstrap-asset-exchange" class="table-of-contents__link toc-highlight">Startup and Bootstrap: Asset Exchange</a></li><li><a href="#startup-and-bootstrap-data-sharing--asset-transfer" class="table-of-contents__link toc-highlight">Startup and Bootstrap: Data Sharing &amp; Asset Transfer</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Weaver Framework.</div></div></div></footer></div>
<script src="/weaver-dlt-interoperability/assets/js/runtime~main.9236cb13.js"></script>
<script src="/weaver-dlt-interoperability/assets/js/main.ace5a136.js"></script>
</body>
</html>