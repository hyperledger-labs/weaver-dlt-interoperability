<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/weaver-dlt-interoperability/blog/rss.xml" title="Weaver: DLT Interoperability Framework Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/weaver-dlt-interoperability/blog/atom.xml" title="Weaver: DLT Interoperability Framework Blog Atom Feed"><title data-react-helmet="true">Corda | Weaver: DLT Interoperability Framework</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Corda | Weaver: DLT Interoperability Framework"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><meta data-react-helmet="true" property="og:url" content="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/corda"><link data-react-helmet="true" rel="shortcut icon" href="/weaver-dlt-interoperability/shared/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/corda"><link rel="stylesheet" href="/weaver-dlt-interoperability/styles.886962d7.css">
<link rel="preload" href="/weaver-dlt-interoperability/styles.3b2edceb.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/runtime~main.3edf7b11.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/main.f1a0b257.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/1.ca5d2ef8.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/2.7dbb3399.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/65.dd70abc9.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/66.39ba37ac.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/935f2afb.6797f59a.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/17896441.7115c955.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/f0c74005.280306bc.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/weaver-dlt-interoperability/"><img src="/weaver-dlt-interoperability/shared/logo.svg" alt="Weaver" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/weaver-dlt-interoperability/shared/logo.svg" alt="Weaver" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Weaver</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/weaver-dlt-interoperability/docs/external/introduction">Docs</a><a class="navbar__item navbar__link" href="/weaver-dlt-interoperability/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/weaver-dlt-interoperability/"><img src="/weaver-dlt-interoperability/shared/logo.svg" alt="Weaver" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/weaver-dlt-interoperability/shared/logo.svg" alt="Weaver" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Weaver</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/weaver-dlt-interoperability/docs/external/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/introduction">Weaver Framework</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weaver-dlt-interoperability/docs/external/getting-started/guide">Using Weaver</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Launching a Test Network</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/test-network/overview">Component Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/test-network/setup-local">Setup with Locally Built Weaver Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/test-network/setup-local-docker">Setup with Locally Built Dockerized Weaver Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/test-network/setup-packages">Setup with Imported Weaver Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/test-network/setup-packages-docker">Setup with Imported Dockerized Weaver Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/test-network/ledger-initialization">Ledger Initialization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/test-network/advanced-configuration">Advanced Configuration</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Testing Interoperation Modes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/interop/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/interop/data-sharing">Data Sharing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/interop/asset-exchange">Asset Exchange</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/getting-started/interop/asset-transfer">Asset Transfer</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Enabling Weaver in your Network and Application</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/fabric">Hyperledger Fabric</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/corda">Corda</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/besu">Hyperledger Besu</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">What is Interoperability?</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/what-is-interoperability/understanding-interoperability">Understanding Interoperability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/what-is-interoperability/levels-of-interoperability">Levels of Interoperability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/what-is-interoperability/integration-patterns">Integration Patterns</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/interoperability-modes">Interoperability Modes</a></li><li class="menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/design-principles">Design Principles</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Stories</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/user-stories/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/user-stories/global-trade">Global Trade</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/user-stories/financial-markets">DvP in Financial Markets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/user-stories/legacy-integration">Legacy Integration</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Architecture and Design</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/architecture-and-design/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/architecture-and-design/relay">Relay</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/architecture-and-design/drivers">Drivers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/architecture-and-design/weaver-dapps">Weaver Dapps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/architecture-and-design/decentralized-identity">Decentralized Identity</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Security Model</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/security-model/authentication">Authentication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/security-model/access-control">Access Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/security-model/proofs-and-verification">Proofs and Verification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/security-model/end-to-end-security">End-to-End Security</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Considerations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/deployment-considerations/deployment-patterns">Deployment Patterns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/deployment-considerations/governance-and-policies">Governance and Policies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/weaver-dlt-interoperability/docs/external/deployment-considerations/legal-and-regulation">Legal and Regulation</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/specifications">Specifications</a></li><li class="menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/weaver-dlt-interoperability/docs/external/publications">Publications</a></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Corda</h1></header><div class="markdown"><p>After testing the Weaver interoperation mechanisms on <a href="/weaver-dlt-interoperability/docs/external/getting-started/test-network/overview">basic sample networks</a>, you may be interested in finding out how you can equip an existing real network, whether in development or in production, to exercise these mechanisms. In this document, we will demonstrate how to equip a Corda network and application with Weaver components and capabilities.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="model"></a>Model<a class="hash-link" href="#model" title="Direct link to heading">#</a></h2><p>The figure below illustrates a typical Corda network. The infrastructure consists of a set of nodes (each maintaining its share of the global state in a local vault), notaries, and CAs. On the nodes are installed one or more CorDapps, representing shared business logic across subsets of those nodes. The core of a CorDapp consists of a collection of workflows (or flows) and contracts acting on states; we layer the flows above the contracts in thebelow image just to illustrate that flows represent transaction (state update) triggers, and contract validations occur during the executions of flows. Further up in the stack lie client applications associated with CorDapps that can are used to trigger flows (and by implication, contracts).</p><p><img alt="alt text" src="/weaver-dlt-interoperability/assets/images/corda-network-model-2e962213e430d787a71559bf2d647f88.png"></p><p>Such a network equipped with Weaver components and capabilities will look like the figure below. Legacy components are marked in grey and Weaver and bridging components in green.</p><p><img alt="alt text" src="/weaver-dlt-interoperability/assets/images/corda-weaver-model-8cd8e458ac29201d610bf4c5f2a99a8c.png"></p><p>The relay and driver are the only additional infrastructure that need to be installed. One or more relays can be installed, as can one or more drivers. The drivers are illustrated in the client layer rather than in the bottom layer because, though they are coupled with relays, they trigger flows just like any client application does.</p><p>Existing CorDapp flows and contracts deployed on the network&#x27;s nodes remain undisturbed. All that is required is the deployment of an Interoperation CorDapp (flows and contracts) on every node that needs to offer or consume state from foreign networks.</p><p>Client applications will need some additional code and configuration because the decisions to exercise interoperation mechanisms (relay queries for data sharing or atomic asset exchanges) are strictly part of business logic. But Weaver&#x27;s Corda Interoperation Node SDK offers various helper functions to ease this process and keep the adaptation to a minimum, as we wil see later in this document. Finally, an <em>identity service</em> must be offered by the network to expose its CAs&#x27; certificate chains to foreign networks, thereby laying the basis for interoperation. This service simply needs to offer a REST endpoint, and can be implemented as a standalone application or (more conveniently) as an augmentation of one or more of the existing client layer applications.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="procedure"></a>Procedure<a class="hash-link" href="#procedure" title="Direct link to heading">#</a></h2><p>Let us walk through the changes that are required in different phases of your network&#x27;s creation.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="development"></a>Development<a class="hash-link" href="#development" title="Direct link to heading">#</a></h3><p>A Corda distributed application&#x27;s business logic code spans three layers as illustrated in the network model:</p><ul><li><p><em>Flows CorDapp</em>: no code changes are required for Weaver enablement, as mentioned above</p></li><li><p><em>Contracts CorDapp</em>: no code changes are required for Weaver enablement, as mentioned above</p></li><li><p><em>Client Layer applications</em>: let us examine the adaptations required in detail:</p><ul><li><p><strong>Identity Service</strong>: A Corda network needs to share its security group (or membership) configuration, i.e., its nodes&#x27; CA certificate chains, with a foreign network with which it seeks to interoperate. Though such sharing can be implemented using several different mechanisms, ranging from manual to automated, the simplest and most modular way is to expose a REST endpoint that agents in foreign networks can reach. Further, this REST endpoint can be implemented as a standalone web application or it can be an extension of one or more of the existing client layer applications. (Multiple apps can expose the same endpoint serving the same information for redundancy.) We will demonstrate an example of this while leaving other implementation modes to the user.
Let&#x27;s say a Corda network consists of two nodes called <code>PartyA</code> and <code>PartyB</code>, each running a client layer application with a web server whose URL prefixes are <code>http://partya.mynetwork.com:9000</code> and <code>http://partyb.mynetwork.com:9000</code> respectively. Each app then can expose a REST endpoint (again, as an example) <code>http://partya.mynetwork.com:9000/node_sec_grp</code> and <code>http://partyb.mynetwork.com:9000/node_sec_grp</code> respectively.
At each web server&#x27;s backend, you need to implement logic to retrieve the node&#x27;s ID and it&#x27;s associated certificated chains. Sample code is given below for a Kotlin implementation built on <code>weaver-corda-sdk</code>. You can use this code verbatim, except for some minor changes like <code>&lt;path-to-root-corda-net-folder&gt;</code>, other parameters like security domain, and list of names of nodes as appropriate for your environment:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import com.weaver.corda.sdk.CredentialsCreator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import com.google.protobuf.util.JsonFormat</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@RestController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@CrossOrigin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@RequestMapping(&quot;/&quot;) // The paths for HTTP requests are relative to this base path.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Controller {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Expose &quot;node_sec_grp&quot; endpoint using Rest Controller</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @RequestMapping(value = [&quot;/node_sec_grp&quot;], method = arrayOf(RequestMethod.GET), produces = arrayOf(&quot;application/json&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private fun GetNetworkConfig(): String {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        val jsonPrinter = JsonFormat.printer().includingDefaultValueFields()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        val credentialsCreator = CredentialsCreator(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;&lt;path-to-root-corda-net-folder&gt;/build/nodes&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;mynetwork&quot;, // security domain name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            [&quot;PartyA&quot;, &quot;PartyB&quot;], // list of nodes </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;&quot;, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Generate Membership</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        val membership = credentialsCreator.createMembership()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return jsonPrinter.print(membership)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>An agent from a foreign network can query either <code>http://partya.mynetwork.com:9000/sec_group</code> or <code>http://partyb.mynetwork.com:9000/sec_group</code> and obtain the security group (or membership) configuration of the entire network.</p></li><li><p><strong>Interoperation Helpers</strong>: Your Corda network&#x27;s client layer applications have business logic embedded in them that, broadly speaking, accept data from users and other external agents and invoke workflows. With the option of interoperability with other networks available through Weaver, other options can be added, namely requesting and accepting data from foreign networks, and triggering locks and claims for atomic exchanges spanning two networks. Weaver&#x27;s Corda SDK (currently implemented both in Java and Kotlin) offers a library to exercise these options. But this will involve modification to the application&#x27;s logic. The following examples will illustrate how you can adapt your applications.</p><ul><li><p><em>Data sharing</em>: Consider a scenario inspired by the <a href="/weaver-dlt-interoperability/docs/external/user-stories/global-trade">global trade use case</a> where a letter of credit (L/C) management business logic is installed in the <code>trade-finance-network</code> network, supports a flow named <code>UploadBillOfLading</code>, which validates and records a bill of lading (B/L) supplied by a user via a UI. Weaver will enable such a B/L to be fetched from a different network <code>trade-logistics-network</code> by querying the function <code>GetBillOfLading</code> exposed by the chaincode <code>shipmentcc</code> installed in the <code>tradelogisticschannel</code> channel (<em>The trade logistics network can be built on Corda as well. The steps for Weaver-enablement will mostly be the same, with the exception of view address creation logic. Here, for demonstration purposes, we assume that that counter-party network is built on Fabric</em>).</p><p>  (In preparation, a suitable access control policy must be recorded on <code>tradelogisticschannel</code> in <code>trade-logistics-network</code>, and a suitable verification policy must be recorded in the vault of <code>trade-finance-network</code>. We will see how to do this in the <a href="#startup-and-bootstrap-weaver-components">Startup and Bootstrap Weaver Components</a> section later.)</p><p>  You will need to insert some code in the client layer application that accepts a B/L and submits a <code>UploadBillOfLading</code> request in <code>trade-finance-network</code>. (No code changes need to be made in any application in the other network.) The logic to accept a B/L should be replaced (or you can simply add an alternative) by a call to the <code>InteroperableHelper.interopFlow</code> function offered by the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/packages/952245" target="_blank" rel="noopener noreferrer">weaver-corda-sdk</a> library. The following code sample illustrates this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kt codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import com.weaver.corda.sdk.InteroperableHelper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import com.mynetwork.flow.UploadBillOfLading</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val viewAddress = InteroperableHelper.createFabricViewAddress(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;trade-logistics-network&#x27;,               // Security Domain/Group</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;trade-logistics-relay-url[:&lt;port&gt;],     // Replace with remote network&#x27;s relay</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;tradelogisticschannel&#x27;,                 // Remote network&#x27;s channel</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;shipmentcc&#x27;,                            // Remote network&#x27;s cc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;GetBillOfLading&#x27;,                       // Remote network&#x27;s cc Fun</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [ &lt;shipment-reference&gt; ]                 // Replace &lt;shipment-reference&gt; with a value that can be used to look up the right B/L</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val response = InteroperableHelper.interopFlow(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        proxy,                                // CordaRPCOps instance to start flows</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        viewAddress,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;trade-finance-relay-url&gt;[:&lt;port&gt;]   // Replace with local network&#x27;s relay address and port</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ).fold({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        println(&quot;Error in Interop Flow: ${it.message}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        val linearId = it.toString()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        val BoLString = InteroperableHelper.getExternalStatePayloadString(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            proxy,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            linearId</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        val result = proxy.startFlow(::UploadBillOfLading, BoLString)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        println(&quot;$result&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">} catch (e: Exception) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    println(&quot;Error: ${e.toString()}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>  Let us understand this code snippet better. The function <code>UploadBillOfLading</code> expects one argument, the bill of lading contents. The <code>InteroperableHelper.createFabricViewAddress</code> is used to create view address that is to passed to <code>InteroperableHelper.interopFlow</code> function. The equivalent function to create a view address for a remote Corda network is <code>InteroperableHelper.createCordaViewAddress</code>. </p><p>  The rest of the code ought to be self-explanatory. Values are hardcoded for explanation purposes.</p><p>  You need to create a <a href="https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">personal access token</a> with <code>read:packages</code> access in Github, to access weaver packages.
You also need to add the following to your application&#x27;s <code>build.gradle</code> file:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-groovy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">repositories {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    maven {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        url https://maven.pkg.github.com/hyperledger-labs/weaver-dlt-interoperability</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        credentials {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            username &lt;github-email&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            password &lt;github-personal-access-token&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dependencies {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    implementation(group: &#x27;com.weaver.corda.sdk&#x27;, name: &#x27;weaver-corda-sdk&#x27;, version: &quot;1.2.3&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    implementation(group: &#x27;com.weaver.corda.app.interop&#x27;, name: &#x27;interop-contracts&#x27;, version: &quot;1.2.3&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    implementation(group: &#x27;com.weaver.corda.app.interop&#x27;, name: &#x27;interop-workflows&#x27;, version: &quot;1.2.3&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    implementation(group: &#x27;com.weaver&#x27;, name: &#x27;protos-java-kt&#x27;, version: &quot;1.2.3&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>(Or check out the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/packages/952245" target="_blank" rel="noopener noreferrer">package website</a> and select a different version.)</p></li><li><p><em>Asset exchange</em>: <em>TBD</em></p></li></ul></li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pre-configuration"></a>Pre-Configuration<a class="hash-link" href="#pre-configuration" title="Direct link to heading">#</a></h3><p>No changes are required in your network&#x27;s pre-configuration process for Weaver enablement.</p><p>Typically, pre-configuration involves:</p><ul><li><p><em>Bootstraping Network</em>:
Generating node folders for each participating node in the network, which contains CorDapps, certificates,  persistence db, etc sub directories. Using Gradle task <code>net.corda.plugins.Cordform</code> or <code>net.corda.plugins.Dockerform</code>, the folders get created under the directory <code>build/nodes</code> (this path is used in above sample code for Identity Service).</p><p>  The RPC address, username and password specified in above task will be used to create an instance of <code>CordaRPCOps</code>, which is the first argument for most <code>weaver-corda-sdk</code> static functions as we saw in previous section. For example, one of them is <code>InteroperableHelper.interopFlow</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val response = InteroperableHelper.interopFlow(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    proxy,                                // CordaRPCOps instance to start flows</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    viewAddress,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;trade-finance-relay-url&gt;[:&lt;port&gt;],   // Replace with local network&#x27;s relay address and port</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>  Also, the Corda Driver (which we will setup in the following sections) needs a specific RPC user to be created, so make sure to add that in the Gradle task above, and note the credentials.</p><p>  Sample <code>net.corda.plugins.Dockerform</code> task:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-groovy codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">task prepareDockerNodes(type: net.corda.plugins.Dockerform, dependsOn: [&#x27;jar&#x27;]) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def HOST_ADDRESS = &quot;0.0.0.0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    nodeDefaults {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        projectCordapp {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            deploy = false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    node {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name &quot;O=Notary,L=London,C=GB&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        notary = [validating : true]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        p2pPort 10004</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        rpcSettings {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address(&quot;$HOST_ADDRESS:10003&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            adminAddress(&quot;$HOST_ADDRESS:10005&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cordapps.clear()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    node {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name &quot;O=PartyA,L=London,C=GB&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        p2pPort 10007</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        rpcSettings {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address(&quot;$HOST_ADDRESS:10003&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            adminAddress(&quot;$HOST_ADDRESS:10005&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        rpcUsers = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                [ user: &quot;user1&quot;, &quot;password&quot;: &quot;test&quot;, &quot;permissions&quot;: [&quot;ALL&quot;]],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                [ user: &quot;driverUser1&quot;, &quot;password&quot;: &quot;test&quot;, &quot;permissions&quot;: [&quot;ALL&quot;]]] // &lt;-- Driver RPC User</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    node {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name &quot;O=PartyB,L=London,C=GB&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        p2pPort 10009</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        rpcSettings {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            address(&quot;$HOST_ADDRESS:10003&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            adminAddress(&quot;$HOST_ADDRESS:10005&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        rpcUsers = [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                [ user: &quot;user1&quot;, &quot;password&quot;: &quot;test&quot;, &quot;permissions&quot;: [&quot;ALL&quot;]],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                [ user: &quot;driverUser1&quot;, &quot;password&quot;: &quot;test&quot;, &quot;permissions&quot;: [&quot;ALL&quot;]]] // &lt;-- Driver RPC User</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p><em>Copy Interoperation CorDapps</em>: After bootstrapping the nodes folder, copy the following two CorDapps in <code>build/nodes/PartyA/cordapps</code> and <code>build/nodes/PartyB/cordapps</code> folders (<code>PartyA</code> and <code>PartyB</code> node names are for example only):</p><ul><li><a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/packages/906215" target="_blank" rel="noopener noreferrer">com.weaver.corda.app.interop.interop-contracts</a></li><li><a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/packages/906216" target="_blank" rel="noopener noreferrer">com.weaver.corda.app.interop.interop-workflows</a></li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="startup-and-bootstrap-weaver-components"></a>Startup and Bootstrap Weaver components<a class="hash-link" href="#startup-and-bootstrap-weaver-components" title="Direct link to heading">#</a></h3><p>To launch a network using containerized components, you will typically use a Docker Compose or Kubernetes configuration file. No modifications are needed to the node&#x27;s configurations. Sample instructions are given below for networks launched using Docker Compose; we leave it to the reader to adapt these to their custom launch processes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="launch-relay"></a>Launch Relay<a class="hash-link" href="#launch-relay" title="Direct link to heading">#</a></h4><p>You can start a relay within a Docker container using a <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/pkgs/container/weaver-relay-server" target="_blank" rel="noopener noreferrer">pre-built image</a>. You just need to customize the container configuration for your Corda network, which you can do by simply creating a folder (let&#x27;s call it <code>relay_config</code>) and configuring the following files in it:</p><ul><li><p><code>.env</code>: This sets suitable environment variables within the relay container. Copy the <code>.env.template</code> file <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/relay/.env.template" target="_blank" rel="noopener noreferrer">from the repository</a> and customize it for your purposes, as indicated in the below sample:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">PATH_TO_CONFIG=./config.toml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RELAY_NAME=&lt;&quot;name&quot; in config.toml&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RELAY_PORT=&lt;relay-server-port/&quot;port&quot; in config.toml&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EXTERNAL_NETWORK=&lt;docker-bridge-network&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_REGISTRY=ghcr.io/hyperledger-labs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_IMAGE_NAME=weaver-relay</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_TAG=1.2.1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>PATH_TO_CONFIG</code> variable should point to the <code>config.toml</code> (you can name this whatever you wish) specified below.</p><p>The <code>RELAY_NAME</code> variable specifies a unique name for this relay. It should match what&#x27;s specified in the <code>config.toml</code> (more on that below).</p><p>The <code>RELAY_PORT</code> variable specifies the port this relay server will listen on. It should match what&#x27;s specified in the <code>config.toml</code> (more on that below).</p><p>The <code>EXTERNAL_NETWORK</code> variable should be set to the <a href="https://docs.docker.com/compose/networking/" target="_blank" rel="noopener noreferrer">name</a> of your Corda network.</p><p>The <code>DOCKER_*</code> variables are used to specify the image on which the container will be built. Make sure you set <code>DOCKER_TAG</code> to the latest version you see on <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/pkgs/container/weaver-relay-server" target="_blank" rel="noopener noreferrer">Github</a>.</p><p>For more details, see the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/relay/relay-docker.md" target="_blank" rel="noopener noreferrer">Relay Docker README</a> (&quot;Relay Server Image&quot; and &quot;Running With Docker Compose&quot; sections).</p></li><li><p><code>config.toml</code>: This specifies properties of the relay and the driver(s) is associates with. A sample is given below:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">name=&lt;relay-name&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port=&lt;relay-port&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">host=&quot;0.0.0.0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">db_path=&quot;db/&lt;relay-name&gt;/requests&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">remote_db_path=&quot;db/&lt;relay-name&gt;/remote_request&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># FOR TLS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cert_path=&quot;credentials/cert.pem&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">key_path=&quot;credentials/key&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tls=&lt;true/false&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[networks]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[networks.&lt;network-name&gt;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">network=&quot;&lt;driver-name&gt;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[relays]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[relays.&lt;foreign-relay-name&gt;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostname=&quot;&lt;foreign-relay-hostname-or-ip-address&gt;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port=&quot;&lt;foreign-relay-port&gt;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[drivers]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[drivers.&lt;driver-name&gt;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostname=&quot;&lt;driver-hostname-or-ip-address&gt;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port=&quot;&lt;driver-port&gt;&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>&lt;relay-name&gt;</code> should be a unique ID representing this relay; e.g., <code>my_network_relay</code>. It should match the <code>RELAY_NAME</code> value in <code>.env</code>.</p><p><code>&lt;relay-port&gt;</code> is the port number the relay server will listen on. It should match the <code>RELAY_PORT</code> value in <code>.env</code>.</p><p><code>db_path</code> and <code>remote_db_path</code> are used internally by the relay to store data. Replace <code>&lt;relay-name&gt;</code> with the same value set for the <code>name</code> parameter. (These can point to any filesystem paths in the relay&#x27;s container.)</p><p>If you set <code>tls</code> to <code>true</code>, the relay will enforce TLS communication. The <code>cert_path</code> and <code>key_path</code> should point to a Corda TLS certificate and key respectively.</p><p><code>&lt;network-name&gt;</code> is a unique identifier for your local network. You can set it to whatever value you wish.</p><p><code>&lt;driver-name&gt;</code> refers to the driver used by this relay to respond to requests. This also refers to one of the drivers&#x27;s specifications in the <code>drivers</code> section further below. In this code snippet, we have defined one driver. Under <code>[drivers.&lt;driver-name&gt;]</code>, you should also specify the hostname and port for the driver (whose configuration we will handle later). (<em>Note</em>: you can specify more than one driver instance in the <code>drivers</code> section.)</p><p>The <code>relays</code> section specifies all foreign relays this relay can connect to. The <code>&lt;foreign-relay-name&gt;</code> value should be a unique ID for a given foreign relay, and this value will be used by your client layer applications when constructing view addresses for data sharing requests. Under <code>[relays.&lt;foreign-relay-name&gt;]</code>, you should specify the hostname and port for the foreign relay. (<em>Note</em>: you can specify more than one foreign relay instance in the <code>relays</code> section.)</p></li><li><p><code>docker-compose.yaml</code>: This specifies the properties of the relay container. You can use the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/relay/docker-compose.yaml" target="_blank" rel="noopener noreferrer">file in the repository</a> verbatim.</p></li></ul><p>To start the relay server, navigate to the folder containing the above files and run the following:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d relay-server</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="launch-driver"></a>Launch Driver<a class="hash-link" href="#launch-driver" title="Direct link to heading">#</a></h4><p>You can start a driver within a Docker container using a <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/pkgs/container/weaver-corda-driver" target="_blank" rel="noopener noreferrer">pre-built image</a>. You just need to customize the container configuration for your Corda network, which you can do by simply configuring the following:</p><ul><li><p><code>.env</code>: This sets suitable environment variables within the driver container. Copy the <code>.env.template</code> file <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/relay/.env.template" target="_blank" rel="noopener noreferrer">from the repository</a> and customize it for your purposes, as indicated in the below sample:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">NETWORK_NAME=&lt;container-name-suffix&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DRIVER_PORT=&lt;driver-server-port&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DRIVER_RPC_USERNAME=&lt;driver-rpc-username&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DRIVER_RPC_PASSWORD=&lt;driver-rpc-username&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EXTERNAL_NETWORK=&lt;docker-bridge-network&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_IMAGE_NAME=ghcr.io/hyperledger-labs/weaver-corda-driver</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DOCKER_TAG=1.2.3</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>NETWORK_NAME</code> is only used as suffix for container and has no other significance.</p><p>The <code>DRIVER_PORT</code> variable should be set to the port this driver will listen on.</p><p>The <code>DRIVER_RPC_USERNAME</code> variable should be set to rpc user created <a href="#pre-configuration">above</a> for the driver.</p><p>The <code>DRIVER_RPC_PASSWORD</code> variable should be set to password of above rpc user.</p><p>The <code>EXTERNAL_NETWORK</code> variable should be set to the <a href="https://docs.docker.com/compose/networking/" target="_blank" rel="noopener noreferrer">name</a> of your Corda network.</p></li><li><p><code>docker-compose.yaml</code>: This specifies the properties of the driver container. You can use the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/core/drivers/corda-driver/docker-compose.yml" target="_blank" rel="noopener noreferrer">file in the repository</a> verbatim.</p></li></ul><p>To start the driver, navigate to the folder containing the above files and run the following:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up -d</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="vault-initialization"></a>Vault Initialization<a class="hash-link" href="#vault-initialization" title="Direct link to heading">#</a></h4><p>To prepare your network for interoperation with a foreign network, you need to record the following to your vault using the <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/packages/952245" target="_blank" rel="noopener noreferrer">Corda SDK</a> (<code>com.weaver.corda.sdk</code>):</p><ul><li><p><strong>Access control policies</strong>:
Let&#x27;s take the example of the request made from <code>trade-finance-network</code> to <code>trade-logistics-network</code> for a B/L earlier in this document. <code>trade-logistics-network</code> can have a policy of the following form permitting access to the <code>GetBillOfLading</code> function from a client representing the <code>PartyA</code> node in <code>trade-finance-network</code> as follows:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-json codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;securityDomain&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;trade-finance-network&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;rules&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;principal&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;PartyA-certificate-pem&gt;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;principalType&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;certificate&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;resource&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;exporternode:10003;carriernode:10003#com.mynetwork.flow.GetBillOfLading:*&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;read&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In this sample, a single rule is specified for requests coming from <code>trade-finance-network</code>: it states that a workflow call to <code>com.mynetwork.flow.GetBillOfLading</code> made to <code>exporter</code> and <code>carrier</code> nodes of remote Corda network is permitted for a requestor whose certificate is specified in the <code>principal</code> attribute. The <code>*</code> at the end indicates that any arguments passed to the function will pass the access control check. The <code>exporternode:10003</code> and <code>carriernode:10003</code> are of form <code>&lt;hostname/IP&gt;:&lt;RPC_Port&gt;</code>, for <code>exporter</code> and <code>carrier</code> nodes respectively in the remote Corda network.</p><p>You need to record this policy rule on your Corda network&#x27;s vault by invoking either the <code>AccessControlPolicyManager.createAccessControlPolicyState</code> function or the <code>AccessControlPolicyManager.updateAccessControlPolicyState</code> function on the <code>weaver-corda-sdk</code>; use the former if you are recording a set of rules for the given <code>securityDomain</code> for the first time and the latter to overwrite a set of rules recorded earlier. The above JSON needs to be converted to protobuf object of <code>com.weaver.protos.common.access_control.AccessControl.AccessControlPolicy</code>, using google&#x27;s protobuf library, and the object is the second argument of above functions (first being the instance of CordaRPCOps).</p></li><li><p><strong>Verification policies</strong>:
Taking the same example as above, an example of a verification policy for a B/L requested by the <code>trade-finance-network</code> from the <code>trade-logistics-network</code> is as follows:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-json codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;securityDomain&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;trade-logistics-network&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;identifiers&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;pattern&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tradelogisticschannel:shipmentcc:GetBillOfLading:*&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;policy&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Signature&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token property">&quot;criteria&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ExporterMSP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CarrierMSP&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In this sample, a single verification policy rule is specified for data views coming from <code>trade-logistics-network</code>: it states that the data returned by the <code>GetBillOfLading</code> query made to the <code>shipmentcc</code> chaincode on the <code>tradelogisticschannel</code> channel requires as proof two signatures, one from a peer in the organization whose MSP ID is <code>ExporterMSP</code> and another from a peer in the organization whose MSP ID is <code>CarrierMSP</code>. (Note: if remote network is built on Corda, the resource from access control policy can be used here as pattern, along with changing the node names in criteria.)</p><p>You need to record this policy rule on your Corda network&#x27;s vault by invoking Corda sdk&#x27;s function <code>VerificationPolicyManager.createVerificationPolicyState(proxy, verificationPolicyProto)</code>, where <code>proxy</code> is an instance of <code>CordaRPCOps</code> as described in previous sections, and <code>verificationPolicyProto</code> is an object of protobuf <code>com.weaver.protos.common.verification_policy.VerificationPolicyOuterClass.VerificationPolicy</code>. You can examine the full proto structure <a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/blob/main/common/protos/common/verification_policy.proto" target="_blank" rel="noopener noreferrer">here</a>. (<em>Google&#x27;s protobuf library can be used to convert above JSON to protobuf object.</em>)</p><p><strong>Note</strong>: For any cross-network data request, make sure an access control policy is recorded in the <em>source network</em> (<code>trade-logistics-network</code> in the above example) and a corresponding verification policy is recorded in the <em>destination network</em> (<code>trade-finance-network</code> in the above example) before any relay request is triggered.</p></li><li><p><strong>Foreign network security group (membership) configuration</strong>:
Run the following procedure (pseudocode) to record security group configuration for every foreign network you wish your Corda network to interoperate with (you will need to collect the identity service URLs for all the foreign networks first):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">for each foreign network:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    send an HTTP GET request to the network&#x27;s identity service (using &#x27;curl&#x27; or &#x27;wget&#x27; from a shell script or equivalent programming language APIs).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    convert the response string to protobuf object of &#x27;com.weaver.protos.common.membership.MembershipOuterClass.Membership&#x27;.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    invoke &#x27;MembershipManager.createMembershipState(proxy, membershipProto)&#x27; or &#x27;MembershipManager.updateMembershipState(proxy, membershipProto)&#x27; on Corda sdk.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>As in the above two cases, use <code>createMembershipState</code> to record a confiuration for the first time for a given <code>securityDomain</code> and <code>updateMembershipState</code> to overwrite a configuration.</p><p><em>Note</em>: security group configurations (organization lists and their certificate chains) for any Fabric/Corda network are subject to change, so you should run the above procedure periodically in a loop.</p></li></ul><p>Your Corda network is now up and running with the necessary Weaver components, and your network&#x27;s vault is bootstrapped with the initial configuration necessary for cross-network interactions!</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/edit/master/docs/external/getting-started/enabling-weaver-network/corda.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/fabric"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Hyperledger Fabric</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/weaver-dlt-interoperability/docs/external/getting-started/enabling-weaver-network/besu"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Hyperledger Besu Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#model" class="table-of-contents__link">Model</a></li><li><a href="#procedure" class="table-of-contents__link">Procedure</a><ul><li><a href="#development" class="table-of-contents__link">Development</a></li><li><a href="#pre-configuration" class="table-of-contents__link">Pre-Configuration</a></li><li><a href="#startup-and-bootstrap-weaver-components" class="table-of-contents__link">Startup and Bootstrap Weaver components</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Weaver Framework.</div></div></div></footer></div>
<script src="/weaver-dlt-interoperability/styles.3b2edceb.js"></script>
<script src="/weaver-dlt-interoperability/runtime~main.3edf7b11.js"></script>
<script src="/weaver-dlt-interoperability/main.f1a0b257.js"></script>
<script src="/weaver-dlt-interoperability/1.ca5d2ef8.js"></script>
<script src="/weaver-dlt-interoperability/2.7dbb3399.js"></script>
<script src="/weaver-dlt-interoperability/65.dd70abc9.js"></script>
<script src="/weaver-dlt-interoperability/66.39ba37ac.js"></script>
<script src="/weaver-dlt-interoperability/935f2afb.6797f59a.js"></script>
<script src="/weaver-dlt-interoperability/17896441.7115c955.js"></script>
<script src="/weaver-dlt-interoperability/f0c74005.280306bc.js"></script>
</body>
</html>