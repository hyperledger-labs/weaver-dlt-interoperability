<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/weaver-dlt-interoperability/blog/rss.xml" title="Weaver: DLT Interoperability Framework RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/weaver-dlt-interoperability/blog/atom.xml" title="Weaver: DLT Interoperability Framework Atom Feed"><title data-react-helmet="true">cordapp-interop | Weaver: DLT Interoperability Framework</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/internal/development/cordapp-interop/cordapp-interop"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="cordapp-interop | Weaver: DLT Interoperability Framework"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><link data-react-helmet="true" rel="shortcut icon" href="/weaver-dlt-interoperability/shared/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/internal/development/cordapp-interop/cordapp-interop"><link data-react-helmet="true" rel="alternate" href="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/internal/development/cordapp-interop/cordapp-interop" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hyperledger-labs.github.io/weaver-dlt-interoperability/docs/internal/development/cordapp-interop/cordapp-interop" hreflang="x-default"><link rel="stylesheet" href="/weaver-dlt-interoperability/assets/css/styles.fe84083a.css">
<link rel="preload" href="/weaver-dlt-interoperability/assets/js/runtime~main.19d8449f.js" as="script">
<link rel="preload" href="/weaver-dlt-interoperability/assets/js/main.43cbafb9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/weaver-dlt-interoperability/"><div class="navbar__logo"><img src="/weaver-dlt-interoperability/shared/logo.svg" alt="Weaver" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/weaver-dlt-interoperability/shared/logo.svg" alt="Weaver" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Weaver</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/weaver-dlt-interoperability/docs/external/introduction">Docs</a><a class="navbar__item navbar__link" href="/weaver-dlt-interoperability/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><main class="docMainContainer_r8cw docMainContainerEnhanced_SOUu"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>cordapp-interop</h1></header><hr><p>id: cordapp-interop
title: Interoperation CorDapp</p><hr><header><h1>Interoperation CorDapp</h1></header><hr><p>  Contributors:    Chander Govindarajan, Allison Irvin, Isabell Kiral</p><hr><p>This document contains the specification for the interoperation application including the system, the CorDapp flow design and the application server details.
This CorDapp serves as the bridge between an established CorDapp and the relay.
There are three main functions of the Interoperation CorDapp:</p><ol><li>It defines states, contracts and flows for authenticating participants of an external network and providing access control to Corda application states. </li><li>It defines flows for enabling an external network to query a Corda application.</li><li>It defines flows for enabling a Corda application to query an external network.</li></ol><p>The Corda interoperability application consists of the CorDapp itself, containing flows, contracts and state definitions, as well as a webserver with a REST API that connects to the Corda nodes via RPC to trigger flows.
There is no user interface for the interoperability functionality.
The REST API is designed to be consumed by a Corda application that wishes to incorporate state synchronisation with an external network. </p><p>To view the assets, flows and API specification in full without any of the descriptions see these pages:</p><ul><li><p><a href="/weaver-dlt-interoperability/docs/internal/development/cordapp-interop/cordapp-interop-assets">CorDapp Assets</a></p></li><li><p><a href="/weaver-dlt-interoperability/docs/internal/development/cordapp-interop/cordapp-interop-api-assets">API Assets</a></p></li><li><p><a href="/weaver-dlt-interoperability/docs/internal/development/cordapp-interop/cordapp-interop-flows">Flows</a></p></li><li><p><a href="/weaver-dlt-interoperability/docs/internal/development/cordapp-interop/cordapp-interop-rest-api">REST API</a></p><hr></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="general-corda-notes">General Corda notes<a aria-hidden="true" class="hash-link" href="#general-corda-notes" title="Direct link to heading">â€‹</a></h2><p>Corda provides many state interfaces to aid in standardisation across CorDapps.
States must extend the <code>ContractState</code> interface, which contains a list of <code>AbstractParty</code>, called <code>participants</code>.
This defines which Corda identities must sign off on transactions that consume state of that type.
For states where instances evolve by superseding itself, Corda provides the <code>LinearState</code> interface.
This includes a property <code>linearId</code>, which is a unique identifier that all versions of the state will preserve throughout the lifecycle of the state. </p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="1-authentication-of-external-networks">1. Authentication of external networks<a aria-hidden="true" class="hash-link" href="#1-authentication-of-external-networks" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="foreign-network-information-management">Foreign Network Information Management<a aria-hidden="true" class="hash-link" href="#foreign-network-information-management" title="Direct link to heading">â€‹</a></h3><p>In order to control access to state in a Corda application or to verify state coming from an external network, the Corda network needs to have some way of authenticating parties in the external network.
The Foreign Network Information Management (FNIM) state contains a network map of the foreign network, including an identifier associated with the foreign network as well as a description of each of the foreign network nodes (<code>FNNode</code>s).
This FNIM state is used to verify the identity of external network parties interacting with the Corda network.
Every interaction requires a signature of the external network party.
The signature is verified against the provided certificate and the authenticity of the certificate is verified against the FNIM state.
In our current design, the definition of these <code>FNNode</code>s is very Fabric-centric, as the Fabric-Fabric interoperability design used the network map the way it was stored on the Ordering Service channel.
In order to not have to make significant changes to the way the Fabric network published its network map, this format was used to consume the FNIM in the Interoperation CorDapp, complete with fields such as <code>crypto_config</code> and <code>fabric_node_ous</code>.
The Fabric nodes&#x27; info was also stored as a key-value with the key being the name of the Fabric organisation (e.g. <code>SellerMSP</code>).
In a more generalised interoperation protocol, we should think about common features that all DLT networks are required to provide in order for external networks to be able to properly identify and authenticate participants. </p><p>An FNIM state is created for an external network on the level of a group of Corda participants.
The Corda participants that are listed in the FNIM state are responsible for creating the FNIM state and ensuring it is kept up to date with the external network configuration.
In the current model, this is done manually, with the endpoint to fetch the network map from the external network through the relay hardcoded into the interoperation REST API endpoint.
This endpoint is also used to update the FNIM state when the foreign network topology changes.
The application middleware checks if there is an FNIM state for that networkId already, and if so, deletes it before creating a new state with the updated details.
In our demo, the participants of the FNIM state are also hardcoded.
The flow that creates an FNIM state does not require any manual sign-off by counterparties.
The flow triggers a subflow in all participant nodes listed in the state, that checks the transaction against the contract and signs the transaction if the verification passes. </p><p>In a more generalised protocol, it would be preferable to have a standardised format for the publication of network maps.
For example, having a decentralised identity platform for the storage of DLT network that were discoverable by other networks would be ideal.
Otherwise, having all networks provide their network map through a consistent API, would also be helpful.</p><p>The Corda parties that control the creation and management of FNIM states in the Corda network also needs to be revisited.
For example, ensuring currency of an FNIM state for a particular external network could be up to a group of participants that share some state together that they wish to have synchronised with the external network.
Alternatively, a dedicated group of Corda parties could be responsible for maintaining currency of the configurations of all the external networks that any group of participants may wish to interoperate with in a Corda network.
The mechanism for updating FNIM state when external network configuration changes should also be revisited, rather than deleting the existing state and creating a new one. </p><p>Similarly to the requirement for a Corda network to have access to the network map of an external network, the external network must also have a snapshot of the Corda network they wish to interoperate with in order to validate requests and responses.
The exposure of the network map is currently done through the individual Corda applications as the information that each network wishes to share externally will vary on a case-by-case basis.
This model can be revised if needed for the next iteration of the protocol.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="fnim-cordapp-assets">FNIM CorDapp Assets<a aria-hidden="true" class="hash-link" href="#fnim-cordapp-assets" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ForeignNetworkInformationManagementState(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        linearId: UniqueIdentifier = UniqueIdentifier(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;Party&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        networkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        topology: List&lt;FNNode&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) : LinearState</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class FNNode(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        admins: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        crypto_config: CryptoConfig,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fabric_node_ous: String?,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        intermediate_certs: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        organizational_unit_identifiers: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        revocation_list: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        root_certs: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        signing_identity: String?,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tls_intermediate_certs: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tls_root_certs: List&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class CryptoConfig(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        identity_identifier_hash_function: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        signature_hash_family: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="fnim-api-assets">FNIM API Assets<a aria-hidden="true" class="hash-link" href="#fnim-api-assets" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class FNIMStateRequest(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        networkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        topology: List&lt;FNNode&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class FNIMStateResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        linearId: UniqueIdentifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        networkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        topology: List&lt;FNNode&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ForeignNetworkMapInformationIntermediateResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CarrierMSP:  FNNode,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SellerMSP: FNNode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="fnim-flows">FNIM Flows<a aria-hidden="true" class="hash-link" href="#fnim-flows" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class FNIMInitiator(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    networkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    topology: List&lt;FNNode&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    participants: List&lt;Party&gt;) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // creates FNIM record for an external network</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class FNIMExitInitiator(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id: String ) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // marks FNIM state as consumed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="fnim-query-flows">FNIM Query Flows<a aria-hidden="true" class="hash-link" href="#fnim-query-flows" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class QueryForeignNetworkInformationManagementStates : List&lt;ForeignNetworkInformationManagementState&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns list of FNIM states</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class QueryForeignNetworkInformationManagementStatesById(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    linearId: UniqueIdentifier) ForeignNetworkInformationManagementState {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns FNIM state</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class QueryForeignNetworkInformationManagementStateByNetworkId(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    networkId: String) ForeignNetworkInformationManagementState {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns FNIM state for specified network</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="fnim-application-rest-api-and-corda-flow-connections">FNIM application REST API and Corda flow connections<a aria-hidden="true" class="hash-link" href="#fnim-application-rest-api-and-corda-flow-connections" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">GET storeFNIM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: ForeignNetworkMapInformationIntermediateResponse, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1. &lt;foreign-network-id-and-certs-configuration-url&gt; to get ForeignNetworkMapInformationIntermediateResponse</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2. QueryForeignNetworkInformationManagementStateByNetworkId to check if FNIM exists for this network already</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3. FNIMExitInitiator (if FNIM exists already)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    4. FNIMInitiator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">POST foreignNetworkInfos</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: FNIMStateRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: FNIMStateResponse, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: FNIMInitiator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DELETE foreignNetworkInfos/{id}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: id, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: FNIMExitInitiator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GET foreignNetworkInfos</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: List&lt;ForeignNetworkInformationManagementState&gt;, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: QueryForeignNetworkInformationManagementStates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GET foreignNetworkInfos/{id}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: ForeignNetworkInformationManagementState, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: QueryForeignNetworkInformationManagementStatesById</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="access-control">Access Control<a aria-hidden="true" class="hash-link" href="#access-control" title="Direct link to heading">â€‹</a></h3><p>The Interoperation CorDapp allows groups of Corda parties to grant access to their application states through <code>AccessControlStates</code>.
These Access Control states are issued on a per-application state and per-external network basis (for example, for a particular letter of credit and for a particular external network).
The application state for which the Access Control state pertains is denoted by the <code>stateLinearId</code> and the external network is specified by the <code>externalNetworkId</code> that should match the <code>externalNetworkId</code> for the FNIM state.
The Access Control state also lists the certificates of the parties of the external network who are allowed to make requests for state.
These are included in the <code>externalNetworkCertificates</code> field. </p><p>This is just one approach that could be used to grant access to foreign network participants.
It may be desirable to be able to set access control rules on a Corda application level (e.g. allow one Access Control state to govern access to <em>all</em> Corda states for a given application).
Therefore, this may need to be revisited for the next version of the interoperation protocol.</p><p>As the Access Control state defines whether an external party can access state from the Corda ledger, explicit approval needs to be given by each participant of the Corda state.
These approvals are captured in an Access Control Request State.
Once all participants have manually approved the request through initiating the <code>AccessControlIssueRequestApprover</code>, an Access Control state will be created. </p><p>The workflow to grant access to application states needs to be built into the application for a particular CorDapp.
For example, as a part of a trade logistics application, one part of the user interface could include allowing particular external network participants to request a current view of a letter of credit state.
All participants of that letter of credit would have to approve the access control request before it becomes active.
This workflow was not built into the Corda-Fabric interoperability demo, with the creation and approval of an Access Control request being triggered through the interoperation middleware when an external network request for Corda state is received.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="access-control-cordapp-assets">Access Control CorDapp Assets<a aria-hidden="true" class="hash-link" href="#access-control-cordapp-assets" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class AccessControlIssueRequestState(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        linearId: UniqueIdentifier = UniqueIdentifier(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkCertificates: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        requestApprovals: List&lt;DigitalSignature.WithKey&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stateLinearId: UniqueIdentifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;Party&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) : LinearState</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class AccessControlState(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        linearId: UniqueIdentifier = UniqueIdentifier(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkCertificates: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stateLinearId: UniqueIdentifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;Party&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) : LinearState</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="access-control-api-assets">Access Control API Assets<a aria-hidden="true" class="hash-link" href="#access-control-api-assets" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class AccessControlIssueRequestStateRequest(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    externalNetworkCertificates: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    stateLinearId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    participants: List&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class AccessControlIssueRequestStateResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        linearId: UniqueIdentifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkCertificates: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        requestApprovals: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stateLinearId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class AccessControlStateResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        linearId: UniqueIdentifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkCertificates: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stateLinearId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="access-control-flows">Access Control Flows<a aria-hidden="true" class="hash-link" href="#access-control-flows" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class AccessControlIssueRequestInitiator(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkCertificates: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stateLinearId: UniqueIdentifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;Party&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Creates an access control request on the ledger for a particular document</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class AccessControlIssueRequestApprover(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id: UniqueIdentifier){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Allows for a party to approve an access control issuance request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Once all parties listed as a participant of the state the access control request pertains to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // have approved the request, an AccessControlState is created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="access-control-query-flows">Access Control Query Flows<a aria-hidden="true" class="hash-link" href="#access-control-query-flows" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class QueryAccessControlIssueRequestStates() List&lt;AccessControlIssueRequestState&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns access control requests</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class QueryAccessControlIssueRequestStateByLinearId(linearId: UniqueIdentifier) AccessControlIssueRequestState {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns access control request by Id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class QueryAccessControlStates() List&lt;AccessControlState&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns list of access control states</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class QueryAccessControlStateByLinearId(linearId: UniqueIdentifier) AccessControlState {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns access control state by Id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class QueryAccessControlStatesByStateIdAndNetworkId(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stateLinearId: UniqueIdentifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkId: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ) AccessControlState {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns access control state by the linearId of the application state and the external network Id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="access-control-application-rest-api-and-corda-flow-connections">Access Control Application REST API and Corda Flow Connections<a aria-hidden="true" class="hash-link" href="#access-control-application-rest-api-and-corda-flow-connections" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">POST accessControlRequests/new</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: AccessControlIssueRequestStateRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: AccessControlIssueRequestStateResponse, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: AccessControlIssueRequestInitiator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">POST /accessControlRequests/approve/{id}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: AccessControlIssueRequestStateResponse, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: AccessControlIssueRequestApprover</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GET accessControlRequests</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: AccessControlIssueRequestStateResponse, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: QueryAccessControlIssueRequestStateByLinearId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GET accessControlStates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: List&lt;AccessControlState&gt;, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: QueryAccessControlStates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GET accessControlStates/{id}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: AccessControlStateResponse, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: QueryAccessControlIssueRequestStateByLinearId</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="2-handle-external-networks-querying-a-corda-application-for-state">2. Handle external networks querying a Corda application for state<a aria-hidden="true" class="hash-link" href="#2-handle-external-networks-querying-a-corda-application-for-state" title="Direct link to heading">â€‹</a></h2><p>An external network can make a request for Corda state by reaching the interoperability CorDapp through the relay. </p><p>For an external network request to be successful it must fulfill the following:</p><ol><li>The identity of the requester needs to be authenticated through a signature on the request and a provided certificate. The signature is either made on the <code>linearId</code> or the <code>txId</code> that is provided in the request.</li><li>The certificate needs to be validated against the FNIM stored for the external network (i.e. the certificate needs to be issued by an issuing CA listed in the FNIM and the hierarchy of certificates in the FNIM needs to be validated up to the rootCA).</li><li>The desired state needs to be located in the vault of the Corda node processing the request.</li><li>A corresponding Access Control state needs to be found for the desired state and the certificate of the requester needs to be listed in the Access Control state.</li></ol><p>The Corda node processing the request then needs to assemble a response object that includes the desired state and a signature on the state that provides evidence that this was the current view of the state according to that node.
The Corda node then needs to forward the request on to all participants of the state, who run through the same process for validation of the request and assembly of the response object.
The responses from each of the Corda nodes are collected by the initial Corda node and returned to the relay who pass the response back to the requesting network.
Collectively, the responses from all Corda nodes (provided they shared the same view of the state) should be enough to convince the requester of the current state in the Corda ledger.
This assumes that the requesting network trusts that the Corda network participants are not colluding to misrepresent the state.
Whether we want to provide stronger assurances of the currency and finality of state by requiring the Notary also sign off on the state can be assessed in the next iteration.</p><p>There must be some way of identifying the desired Corda state without necessitating that the interoperation Cordapp be aware of the data classes of the Corda application.
In Fabric, this was done by the requesting network passing the chaincode query function name and the query in the request.
In Corda, this approach needs to be revisited because there is no concept of a chaincode query function.
The initial approach taken in the demo was to identify the Corda state by linearId as this guarantees that the state can be uniquely identified in the vault.
However, there is no guarantee that states will have a unique identifier as not all application states will extend the <code>LinearState</code> interface.
As well, the <code>linearId</code> is a property generated in Corda on creation of the state and may be meaningless in the business process.
Therefore, it cannot be assumed that an external network will have visibility of the <code>linearId</code>.
Our workaround for the demo was to create a custom endpoint <code>externalNetworkRequestByTxId</code> where the desired state was identified by a property unique to a letter of credit - the <code>txId</code>.
A set of linearIds that corresponded to that txId were then found using a custom flow called <code>GetLinearIdsFromTxId</code>.
The request was then validated according to the criteria above (valid signature, valid certificate according to FNIM, valid Access Control state) and a response object generated for each state located by linearId.
Other approaches that could be more appropriate for Corda may include creating query flows in the CorDapp application that work in a similar way to chaincode query functions.
This would involve investigating if cross-CorDapp triggering of flows is possible, and if so, how they can be executed.
Another approach could be requiring a <code>CustomQueryCriteria</code> in the request that comes from the external network.
Again, we would have to investigate if <code>CustomQueryCriteria</code> can be used in a CorDapp that has no knowledge of the application states for which that query pertains.
Regardless of the approach to address state within Corda, for the next iteration of the protocol we need to think about how to generalise this across enterprise DLTs. </p><p>Another workaround for the demo also of note here is the automatic generation of an Access Control state for the states specified in the request.
As we had not implemented any workflow or user interface in the Corda application for granting access to external network participants, creation of an Access Control state was triggered when the interoperation CorDapp received a request from an external network.
Note that the functionality for a Corda application to incorporate the creation of Access Control states into their workflows is present in the interoperation APIs.
This workaround was put in place purely because the demo did not include a demonstration of this workflow.
Some further thought will need to be put into the workflow in the application CorDapp, especially with how external network parties are represented (for example, will the application CorDapp require access to the participant certificates listed in the FNIM?).</p><p>Things to think about in the next iteration of the protocol:</p><ul><li>Trust model of the relay - does the request need to be encrypted?</li><li>How do we address the Corda nodes in the request so the relay can know which node to forward the request on to</li><li>Do we need to include guidelines about the encryption and signature schemes that can be used? Will accepted encryption and signature schemes vary on a network-by-network basis? If so, do we need some way of publishing what encryption and signature schemes a network accepts?</li><li>How to generalise the addressing of state? In Corda this could be a <code>CustomQueryCriteria</code>, in Fabric this is currently done through chaincode function and query</li><li>How to handle multiple states being found</li><li>Next iteration needs to handle replay attacks - provide a nonce in the request</li><li>Currently the <code>organizationName</code> of the requester is required in the request. We need a more general way of linking the requester identity with the issuing CA in the FNIM. </li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="handle-requests-from-foreign-network---cordapp-assets">Handle Requests From Foreign Network - CorDapp Assets<a aria-hidden="true" class="hash-link" href="#handle-requests-from-foreign-network---cordapp-assets" title="Direct link to heading">â€‹</a></h4><p>The <code>StateQueryResponse</code> is the object assembled by each Corda node for each requested state.
The <code>requestedState</code> field is a JSON string of the <code>QueryResponse</code> that is encoded in Base64 as a bytearray.
The <code>certificate</code> is the certificate of the Corda node providing the state and is used by the requesting network to validate the signature and the identity of the Corda node against their locally stored copy of the Corda network FNIM.
The <code>signature</code> is the signature of the Corda node signed on the <code>requestedState</code> bytearray. </p><p>The <code>state</code> field in <code>QueryResponse</code> is a JSON string of the Corda application state.
For the demo, some of the JSON attributes were manipulated by converting to lowercase from camelcase, and renaming some fields.
This was done as the Fabric application was expecting the letter of credit state to be returned in a particular form.
Ideally, the Interoperation CorDapp would not manipulate the state in any way before it is returned.
It also cannot be expected that the Corda application needs to modify its data structures in any way to conform with an external network&#x27;s data structure.
It should be up to the consuming network to parse the state it receives into a meaningful format for its own application. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class StateQueryResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    requestedState: ByteArray, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    certificate: ByteArray,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    signature: ByteArray </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class QueryResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        state: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        linearId: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="handle-requests-from-foreign-network---api-assets">Handle Requests From Foreign Network - API Assets<a aria-hidden="true" class="hash-link" href="#handle-requests-from-foreign-network---api-assets" title="Direct link to heading">â€‹</a></h4><p><code>ExternalNetworkRequest</code> or <code>ExternalNetworkRequestWithTxId</code> are the two request bodies that the external network can provide.
These are based on whether the external network is identifying the Corda application state by <code>linearId</code> or <code>txId</code>.
As mentioned previously, for the demo the latter request type was used as we assumed that the external network would not have any visibility of the <code>linearId</code> property of a Corda state.
The <code>externalNetworkId</code> needs to match with the <code>externalNetworkId</code> used to store the FNIM for the requesting network.
The <code>organizationName</code> is a Fabric-specific artifact that stems from the way identities are grouped under organizations.
This field is needed in order to validate the identity of the requester in the FNIM by finding the correct issuing CA of the credentials.
This will need to be revised in the next iteration of the protocol as the FNIM will need to be generalised to be applicable to all enterprise DLTs. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ExternalNetworkRequest(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    organizationName: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    requesterCertificate: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    requesterSignature: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    stateLinearId: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ExternalNetworkRequestWithTxId(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    organizationName: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    requesterCertificate: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    requesterSignature: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    txId: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="handle-requests-from-foreign-network---flows">Handle Requests From Foreign Network - Flows<a aria-hidden="true" class="hash-link" href="#handle-requests-from-foreign-network---flows" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class StateQueryInitiator(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    organizationName: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    stateLinearId: UniqueIdentifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    requesterCertString: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    requesterSignature: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    txId: String?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) List&lt;StateQueryResponse&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns requested state and associated proof</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class GetLinearIdsFromTxId(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    txId: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) List&lt;UniqueIdentifier&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns list ids for states that match the query criterion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="handle-requests-from-foreign-network---application-rest-api-and-corda-flow-connections">Handle Requests From Foreign Network - Application REST API and Corda Flow Connections<a aria-hidden="true" class="hash-link" href="#handle-requests-from-foreign-network---application-rest-api-and-corda-flow-connections" title="Direct link to heading">â€‹</a></h4><p>The <code>externalNetworkRequest POST</code> endpoint is used to find the Corda application state based on <code>linearId</code>.
It will return a <code>StateQueryResponse</code> for each Corda node listed as a participant in the state, or in the case that a state is not found or access is denied for the requester, will fail.
The <code>externalNetworkRequestByTxId POST</code> endpoint finds Corda application state based on <code>txId</code> and could potentially match with multiple states.
Therefore, for each accessible state found, each Corda node listed as a participant in the state will provide a <code>StateQueryResponse</code>.
If no states are found or the requester does not have permission to access the state, an empty list will be returned.
Note that the access control calls that are made are purely a workaround from the fact that the setup of state access control was not built into the demo.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">POST externalNetworkRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: ExternalNetworkRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: List&lt;StateQueryResponse&gt;, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1. &lt;interoperation-webserver1-url&gt;/accessControlRequests/new</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2. &lt;interoperation-webserver2-url&gt;/accessControlRequests/approve</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3. StateQueryInitiator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">POST externalNetworkRequestByTxId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: ExternalNetworkRequestWithTxId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: List&lt;List&lt;StateQueryResponse&gt;?&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1. &lt;interoperation-webserver1-url&gt;/accessControlRequests/new</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2. &lt;interoperation-webserver2-url&gt;/accessControlRequests/approve</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3. GetLinearIdsFromTxId</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    4. StateQueryInitiator (for each linearId)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="3-requests-to-get-state-from-external-networks">3. Requests to get state from external networks<a aria-hidden="true" class="hash-link" href="#3-requests-to-get-state-from-external-networks" title="Direct link to heading">â€‹</a></h2><p>In the opposite case from the previous section, the Interoperation CorDapp also allows a Corda application to request a state from an external network.
This consists of the following steps:</p><ol><li>A Corda application uses the Interoperation CorDapp API to trigger the request to the external network (takes a <code>ExternalStateRequest</code>)</li><li>The Interoperation CorDapp creates a request object to send to the foreign network&#x27;s relay (<code>RelayRequestObject</code>)</li><li>The returned state and proofs are validated</li><li>The external network&#x27;s state is stored in the vault along with the associated proofs</li><li>The <code>linearId</code> of the state is returned to the Corda application</li><li>The Corda application retrieves the state from the vault</li></ol><h4 class="anchor anchorWithStickyNavbar_y2LR" id="request-state-from-external-network---cordapp-assets">Request State from External Network - CorDapp Assets<a aria-hidden="true" class="hash-link" href="#request-state-from-external-network---cordapp-assets" title="Direct link to heading">â€‹</a></h4><p>The <code>ExternalStateRequest</code> is the request object the webserver receives as part of the <code>POST requestExternalState</code> endpoint.
It is used by the webserver to know how to address the relay and it is also passed on to the <code>CreateExternalRequestStateObject</code> flow to construct the request object that will be forwarded to the relay.
The <code>url</code> and the <code>path</code> are required to the webserver knows how to address the relay to forward the request on to.
The <code>externalNetworkId</code> identifies the external network the relay needs to forward the request to and needs to match the id used in the FNIM.
The <code>arguments</code> contains the arguments that will be passed to the specified chaincode function, <code>function</code>.
These parameters, <code>arguments</code> and <code>function</code> are very Fabric-centric and we should generalise the method of addressing state across DLTs for future iterations of the interoperation protocol.
The <code>participants</code> is the list of Corda participants that will need own the Fabric state when it is stored in Corda.
To make this code a little cleaner, we should probably have the request object received by the webserver defined in the API assets, which should include <code>url</code>, <code>path</code>, <code>participants</code> and <code>requestParameters</code>.
The <code>requestParameters</code> would be forwarded on to the <code>CreateExternalRequestStateObject</code> flow, and would only include those fields relevant to the flow (<code>externalNetworkId</code>, <code>function</code> and <code>arguments</code>).
However, seeing as the way we address state in a more general protocol is going to change, we probably don&#x27;t need to worry about cleaning this up in the demo code. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ExternalStateRequest(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        url: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        path: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        arguments: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        function: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>RelayRequestObject</code> is what the interoperation CorDapp sends to the relay to forward on to the Fabric network.
<code>operationType</code> defines the type of operation the Corda network wants to perform on the chaincode - either <code>INVOKE</code> or <code>QUERY</code>.
For now, the <code>QUERY</code> operation is the only one that is supported on the Fabric end and is hardcoded in the <code>CreateExternalRequestStateObject</code> flow where an instance of  <code>RelayRequestObject</code> is created.
To be consistent, <code>operationType</code> should probably have been included in the <code>ExternalStateRequest</code> that was passed into the flow.
Again, seeing as the way we address state is going to change, we won&#x27;t worry about changing the demo code.
The <code>policy</code> refers to the endorsement policy of the Fabric channel for the particular state that the Corda application is requesting.
A more detailed discussion of how the <code>policy</code> is defined and how it <em>should</em> be defined is in the <a href="#writestatefromexternalnetworkflows">flows section</a>.
The fields <code>function</code> and <code>arguments</code> are copied across from what is provided in the <code>ExternalStateRequest</code> that comes from the client application.
On the Fabric end, the Fabric nodes will want to authenticate the Corda node making the request - enabled through <code>clientOrganizationId</code>, <code>clientCertificate</code> and <code>clientSignature</code>. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class RelayRequestObject(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        operationType: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        policy: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        function: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        arguments: List&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        clientOrganizationId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        clientCertificate: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        clientSignature: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>ExternalStateObjectState</code> is the way the state and proof that is returned from the external network is saved as a state in the Corda vault.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ExternalStateObjectState(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        linearId: UniqueIdentifier = UniqueIdentifier(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        participants: List&lt;Party&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalState: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        responseObject: List&lt;FormattedResponse&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) : LinearState</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class FormattedResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        organizationName: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        decryptedPayload: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        certString: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        signatureBytes: ByteArray,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        message: ByteArray,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        publicKey: PublicKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class RelayResponseObject(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        requestId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        status: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        response: List&lt;NodeResponse&gt;?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class NodeResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        proposal: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        proposalResponse: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class RelayRequestId(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        requestId: String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ParsedQueryObject(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        linearId: UniqueIdentifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        txId: String?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class NetworkMapObject(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        networkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        nodes: List&lt;Node&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class Node(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        address: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hierarchicalCerts: List&lt;ByteArray&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hierarchicalCANames: List&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="writestatefromexternalnetworkflows">WriteStateFromExternalNetworkFlows<a aria-hidden="true" class="hash-link" href="#writestatefromexternalnetworkflows" title="Direct link to heading">â€‹</a></h4><p>The <code>CreateExternalRequestStateObject</code> flow takes the request from the Corda application (through the webserver) and creates the request object that the relay needs to pass on to the external network.
It first looks up the FNIM for the external network based off the provided external netowrk id.
The <code>policy</code> for the <code>RelayRequestObject</code> is created by concatenating the name of each of the <code>FNNode</code>s that are present in the <code>ForeignNetworkInformationManagementState</code> for that network, separated by the <code>&amp;</code> symbol (e.g. for the demo <code>SellerMSP &amp; CarrierMSP</code>).
This approach is not ideal as it is very Fabric-centric and is currently hardcoded to be all of the nodes listed in the FNIM for the network, which may or may not be the correct endorsement policy needed for the state.
How endorsement policy should be represented in the interoperation CorDapp has been raised as an <a href="https://github.ibm.com/dlt-interoperability/cordapp-interop/issues/35" target="_blank" rel="noopener noreferrer">issue in the <code>cordapp-interop</code> repo</a>.
The endorsement policy is a concept that is present in all permissioned DLTs (although not always called &quot;endorsement policy&quot;).
It refers to the set of parties who have ownership of a state, or who control the update of a state.
We should generalise this concept in the next iteration of the protocol and store the endorsement policies for an external network as states that can be looked up by the interop CorDapp.
The <code>clientCertificate</code> is a string of the Corda node X.509 certificate in PEM format.
The signature is a Base 64 string, signed on a concatenation of the <code>function</code>, <code>arguments</code> and <code>clientOrganizationId</code> represented as Base 64 byte arrays.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class CreateExternalRequestStateObject(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        request: ExternalStateRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) RelayRequestObject {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // returns request object to query relay about a foreign network state</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>WriteExternalStateInitiator</code> flow is used to verify the state proof that is returned from the external network and commit the state to the vault. </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class WriteExternalStateInitiator(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nodeResponses: List&lt;NodeResponse&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    externalNetworkId: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    participants: List&lt;Party&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) UniqueIdentifier {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // writes external state to ledger and returns unique identifier to be used to query from MarcoPolo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="application-rest-api-and-corda-flow-connections">Application REST API and Corda flow connections<a aria-hidden="true" class="hash-link" href="#application-rest-api-and-corda-flow-connections" title="Direct link to heading">â€‹</a></h4><hr><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">POST requestExternalState</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">req: ExternalStateRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">res: UniqueIdentifier, or failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">calls: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1. CreateExternalRequestStateObject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2. HTTP POST request to relay with the provided url and path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3. HTTP GET request to relay to get the response from the external network</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    4. WriteExternalStateInitiator</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/hyperledger-labs/weaver-dlt-interoperability/edit/master/docs/internal/development/cordapp-interop/cordapp-interop.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#general-corda-notes" class="table-of-contents__link toc-highlight">General Corda notes</a></li><li><a href="#1-authentication-of-external-networks" class="table-of-contents__link toc-highlight">1. Authentication of external networks</a><ul><li><a href="#foreign-network-information-management" class="table-of-contents__link toc-highlight">Foreign Network Information Management</a></li><li><a href="#access-control" class="table-of-contents__link toc-highlight">Access Control</a></li></ul></li><li><a href="#2-handle-external-networks-querying-a-corda-application-for-state" class="table-of-contents__link toc-highlight">2. Handle external networks querying a Corda application for state</a></li><li><a href="#3-requests-to-get-state-from-external-networks" class="table-of-contents__link toc-highlight">3. Requests to get state from external networks</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Weaver Framework.</div></div></div></footer></div>
<script src="/weaver-dlt-interoperability/assets/js/runtime~main.19d8449f.js"></script>
<script src="/weaver-dlt-interoperability/assets/js/main.43cbafb9.js"></script>
</body>
</html>